var Ht=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var $n=Ht((jn,Oe)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const ie=document.getElementById("editor");function at(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}function Ft(){const e=document.createElement("div");return e.setAttribute("id",`blockingPage${at()}`),document.body.appendChild(e),function(){e.remove()}}function Ce(e,t){const n=window.getSelection(),i=document.createRange();return i.setStart(e,t),i.collapse(!0),n.removeAllRanges(),n.addRange(i),i}function Ut(e,t){if(e&&!ie.contains(e)){const n=t?document.getElementById(t):null;(!n||ie.contains(n))&&(ie.insertBefore(e,n),(e.classList?.contains("text-block")||e.classList?.contains("code-block"))&&(e.classList?.contains("text-block")?Ce(e,0):Ce(e.querySelector("code"),0)))}}function Pt(e,t){if(e&&ie.contains(e))if(e.classList?.contains("text-block")||e.classList?.contains("code-block")){let n=e.previousElementSibling;for(;n&&!n.classList?.contains("text-block")&&!n.classList?.contains("code-block");)n=n.previousElementSibling;ie.removeChild(e),n?n.classList?.contains("text-block")?Ce(n,0):Ce(n.querySelector("code"),0):ie.focus()}else ie.removeChild(e),ie.focus()}function $t(e=null){const t=document.createElement("div");return t.innerText="âŒ",e?t.addEventListener("click",function(n){e()},!1):t.setAttribute("onclick","handleXRemoveEvent(event)"),t.setAttribute("class","x-remover non-selectable"),t.setAttribute("contenteditable","false"),t}window.editor_imodule_obj={};window.editor_imodule_obj.generateUId=at;window.editor_imodule_obj.blockPageInteraction=Ft;window.editor_imodule_obj.setCaret=Ce;window.editor_imodule_obj.editorInsertBefore=Ut;window.editor_imodule_obj.editorRemoveChild=Pt;window.editor_imodule_obj.createRemover=$t;const Te=document.getElementById("editor"),Kt=window.editor_imodule_obj.generateUId,jt=window.editor_imodule_obj.blockPageInteraction;window.editor_imodule_obj.setCaret;const Je=window.editor_imodule_obj.editorInsertBefore,Gt=window.editor_imodule_obj.editorRemoveChild,qt=window.editor_imodule_obj.createRemover;function Wt(e,t,n=null){if(e){let i=null;const o=Kt(),r=`epub${o}`;n?.replaceChildren();const l=n||document.createElement("div");l.setAttribute("class","embedded-local-epub epub-loading"),l.setAttribute("contenteditable","false"),l.setAttribute("data-epub",e);const s=()=>{!Te.contains(l)&&i&&(i.destroy(),i=null,console.log("Epub book destroyed."))},a=(f,g)=>{Gt(f,g)};a.cleanup=s,n||Te.UNDO_STACK.push(Je,a,l,t?.id),setTimeout(async()=>{const f=jt();try{i=ePub(await(await window.fetch(e)).blob())}catch(p){console.log(p),f(),n||UNDO_STACK.removeLast(),Te.contains(l)&&Te.removeChild(l);return}f();const g=`toc${o}`,E=document.createElement("div");E.style="float: top; display: flow-root;",E.setAttribute("contenteditable","false");const c=document.createElement("div"),d=document.createElement("div");c.setAttribute("id",`prev${o}`),d.setAttribute("id",`next${o}`),c.setAttribute("class","non-selectable"),d.setAttribute("class","non-selectable"),c.textContent="<PREV",d.textContent="NEXT>",c.style="float: left; left: 0; margin: 5px 5px; cursor: pointer;",d.style="float: right; right: 0; margin: 5px 5px; cursor: pointer;",c.setAttribute("contenteditable","false"),d.setAttribute("contenteditable","false"),E.appendChild(c),E.appendChild(d);const A=document.createElement("select"),T=document.createElement("div");T.style="flex: top;",T.setAttribute("class","ebook-content"),T.setAttribute("id",r),A.style="float: top; left: 0; margin: 5px 5px; background: inherit; color: inherit;",A.setAttribute("id",g),l.appendChild(A),l.appendChild(E),l.appendChild(T),T.book=i,(l.getAttribute("data-readonly")??!1)||l.appendChild(qt(function(){Te.UNDO_STACK.push(a,Je,l,t?.id)}));const b=i.renderTo(r,{flow:"scrolled",width:"100%",height:600,replacements:"base64"}),v=function(p){(p.keyCode||p.which)===37&&b?.prev(),(p.keyCode||p.which)===39&&b?.next()};b?.on("keyup",v),document.addEventListener("keyup",v,!1),c.addEventListener("click",function(p){b?.prev(),p.preventDefault()},!1),d.addEventListener("click",function(p){b?.next(),p.preventDefault()},!1),b?.display(),i.loaded.navigation.then(function(p){l.classList.remove("epub-loading");const u=document.createDocumentFragment();p.forEach(function(y){const C=document.createElement("option");C.textContent=y.label,C.setAttribute("ref",y.href),u.appendChild(C)}),A.appendChild(u),A.onchange=function(){const y=A.selectedIndex,C=A.options[y].getAttribute("ref");return b?.display(C),!1}});function m(p){let u=!1;if(p){const y=document.getElementById(g),C=y.querySelector("option[selected]");C&&C.removeAttribute("selected");const w=y.querySelectorAll("option");for(let h=0;h<w.length;++h)w[h].getAttribute("ref")===p&&(w[h].setAttribute("selected","true"),y.selectedIndex=h,u=!0)}return u}b?.on("rendered",function(p){const u=i.navigation&&i.navigation.get(p.href);m(u?.href)}),b?.on("relocated",function(p){let u=i.navigation.get(p.start?.href);for(;u?.parent;)u=i.navigation.get(u.parent);m(u?.href)})},0)}}window.editor_imodule_obj.loadEpub=Wt;const $=window.editor_imodule_obj.generateUId;window.editor_imodule_obj.blockPageInteraction;const oe=window.editor_imodule_obj.setCaret,U=window.editor_imodule_obj.editorInsertBefore,G=window.editor_imodule_obj.editorRemoveChild,Z=window.editor_imodule_obj.createRemover,Xt=window.editor_imodule_obj.loadEpub;document.getElementById("text28096aea6fa9cc5d10934d24509e2c83")?.setAttribute("id",`text${$()}`);function ct(e,t,n){function i(l){return l.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}const o=new Intl.DateTimeFormat(Intl.DateTimeFormat().resolvedOptions().locale).format(n),r=new Intl.DateTimeFormat(Intl.DateTimeFormat().resolvedOptions().locale).format(t);r!==o?e.textContent=`${r} | ${o} ${i(n.getHours())}:${i(n.getMinutes())}:${i(n.getSeconds())}`:e.textContent=`${r} | ${i(n.getHours())}:${i(n.getMinutes())}:${i(n.getSeconds())}`}const ue=document.getElementById("noteDates");if(ue.textContent?.length){const e=new Date(Date.parse(ue.getAttribute("data-created-time"))),t=new Date(Date.parse(ue.getAttribute("data-last-saved-time")));ct(ue,e,t)}else{const e=new Date;ue.setAttribute("data-created-time",`${e.toISOString()}`),ue.setAttribute("data-last-saved-time",`${e.toISOString()}`),ue.textContent=new Intl.DateTimeFormat(Intl.DateTimeFormat().resolvedOptions().locale).format(e)}/**
 *  PDFObject v2.3.1
 *  https://github.com/pipwerks/PDFObject
 *  @license
 *  Copyright (c) 2008-2025 Philip Hutchison
 *  MIT-style license: http://pipwerks.mit-license.org/
 *  UMD module pattern from https://github.com/umdjs/umd/blob/master/templates/returnExports.js
 */(function(e,t){typeof define=="function"&&define.amd?define([],t):typeof Oe=="object"&&Oe.exports?Oe.exports=t():e.PDFObject=t()})(globalThis,function(){if(typeof window>"u"||window.navigator===void 0||window.navigator.userAgent===void 0)return!1;let e="2.3.1",t=window,n=t.navigator,i=n.userAgent,o=!1,r=function(){let b=t.chrome!==void 0,v=t.safari!==void 0||n.vendor!==void 0&&/Apple/.test(n.vendor)&&/Safari/.test(i),m=t.Mozilla!==void 0||/irefox/.test(i);return b||v||m},l=function(b){var v=null;try{v=new ActiveXObject(b)}catch{v=null}return!!v},s=function(){return"ActiveXObject"in t&&(l("AcroPDF.PDF")||l("PDF.PdfCtrl"))},f=function(){if(n.platform!==void 0&&n.platform==="MacIntel"&&n.maxTouchPoints!==void 0&&n.maxTouchPoints>1||/Mobi|Tablet|Android|iPad|iPhone/.test(i))return!1;let m=typeof n.pdfViewerEnabled=="boolean";return m&&!n.pdfViewerEnabled?!1:m&&n.pdfViewerEnabled||r()||s()}(),g=function(b){let v="",m,p=[],u="";if((b.comment||b.viewrect||b.highlight)&&(b.page||(b.page=1,E("The comment, viewrect, and highlight parameters require a page parameter, but none was specified. Defaulting to page 1."))),b.page&&(p.push("page="+encodeURIComponent(b.page)),delete b.page),b.fdf&&(u=b.fdf,delete b.fdf),b){for(m in b)b.hasOwnProperty(m)&&p.push(encodeURIComponent(m)+"="+encodeURIComponent(b[m]));u&&p.push("fdf="+encodeURIComponent(u)),v=p.join("&"),v&&(v="#"+v)}return v},E=function(b){return o||console.log("[PDFObject]",b),!1},c=function(b){for(;b.firstChild;)b.removeChild(b.firstChild)},d=function(b){let v=document.body;return typeof b=="string"?v=document.querySelector(b):t.jQuery!==void 0&&b instanceof jQuery&&b.length?v=b.get(0):b.nodeType!==void 0&&b.nodeType===1&&(v=b),v},A=function(b,v,m,p){if(window.Blob&&window.URL&&window.URL.createObjectURL){var u=new XMLHttpRequest;u.open("GET",b,!0),u.responseType="blob",u.onload=function(){if(u.status===200){var y=u.response,C=document.createElement("a");C.innerText="Download PDF",C.href=URL.createObjectURL(y),C.setAttribute("download",v),m.innerHTML=p.replace(/\[pdflink\]/g,C.outerHTML)}},u.send()}},T=function(b,v,m,p,u,y,C,w,h,I,k){c(v);let O=m;if(b==="pdfjs"){let B=k.indexOf("?")!==-1?"&":"?";O=k+B+"file="+encodeURIComponent(m)+p}else O+=p;let x=document.createElement("iframe");if(x.className="pdfobject",x.type="application/pdf",x.title=w,x.src=O,x.allow="fullscreen",x.frameborder="0",C&&(x.id=C),!h){let B="border: none;";v!==document.body?B+="width: "+u+"; height: "+y+";":B+="position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%;",x.style.cssText=B}let F=["className","type","title","src","style","id","allow","frameborder"];return I&&I.key&&F.indexOf(I.key)===-1&&x.setAttribute(I.key,typeof I.value<"u"?I.value:""),v.classList.add("pdfobject-container"),v.appendChild(x),v.getElementsByTagName("iframe")[0]},M=function(b,v,m){let p=v||!1,u=m||{};o=typeof u.suppressConsole=="boolean"?u.suppressConsole:!1;let y=typeof u.id=="string"?u.id:"",C=u.page||!1,w=u.pdfOpenParams||{},h=typeof u.fallbackLink=="string"||typeof u.fallbackLink=="boolean"?u.fallbackLink:!0,I=u.width||"100%",k=u.height||"100%",O=u.title||"Embedded PDF",x=typeof u.forcePDFJS=="boolean"?u.forcePDFJS:!1,F=typeof u.omitInlineStyles=="boolean"?u.omitInlineStyles:!1,B=u.PDFJS_URL||!1,K=d(p),V="",ae=u.customAttribute||{},ce=u.fallbackFileNameForBase64,pe="<p>This browser does not support inline PDFs. Please download the PDF to view it: [pdflink]</p>";if(typeof b!="string")return E("URL is not valid");if(!K)return E("Target element cannot be determined");if(C&&(w.page=C),V=g(w),x&&B)return T("pdfjs",K,b,V,I,k,y,O,F,ae,B);if(f)return T("iframe",K,b,V,I,k,y,O,F,ae);if(B)return T("pdfjs",K,b,V,I,k,y,O,F,ae,B);if(h)if(typeof h=="string")K.innerHTML=h.replace(/\[url\]/g,b);else{const Ie=b.match(/data:application\/pdf;(?:.*filename=([^;]+);)?.*base64,/i);if(Ie)ce=ce||Ie[1]||"file.pdf",A(b,ce,K,pe);else{let _t="<a href='"+b+"'>Download PDF</a>";K.innerHTML=pe.replace(/\[pdflink\]/g,_t)}}return E("This browser does not support embedded PDFs")};return{embed:function(b,v,m){return M(b,v,m)},pdfobjectversion:function(){return e}(),supportsPDFs:function(){return f}()}});const Pe=new EventTarget,Vt=(e,t)=>(Pe.addEventListener(e,t),()=>Pe.removeEventListener(e,t)),fe=(e,t)=>Pe.dispatchEvent(new CustomEvent(e,{detail:t}));class _{static MAX_UNDO=1e4;static#t="UNDO_STACK_CHANGE";static#e=0;static#o=1;static#l=2;static#s=3;static#d=4;static#a=5;static#c=6;#n=[];#i=[];constructor(){}get undoCount(){return this.#n.length}get redoCount(){return this.#i.length}get undoAvailable(){return this.#n.length>0}get redoAvailable(){return this.#i.length>0}onChange(t){return Vt(_.#t,t)}static#r(t){for(let n of t)n?.cleanup()}clear(){(this.#n.length>0||this.#i.length>0)&&(_.#r(this.#n),_.#r(this.#i),this.#n.length=0,this.#i.length=0,console.log("Undo/redo stacks cleared."),fe(_.#t,_.#e))}clearRedo(){this.#i.length>0&&(_.#r(this.#i),this.#i.length=0,console.log("Redo stack cleared."),fe(_.#t,_.#o))}push(t,n,...i){const o=i,r={doWithData(){t(...o)},undoWithData(){n(...o)},cleanup(){t.cleanup&&t.cleanup(),n.cleanup&&n.cleanup()}};if(r.doWithData(),this.#n.length===_.MAX_UNDO){const l=this.#n.shift();l&&(l.cleanup(),fe(_.#t,_.#c))}return this.#n.push(r),_.#r(this.#i),this.#i.length=0,fe(_.#t,_.#l),this.#n.length-1}replace(t,n,i,...o){if(t>-1&&t<this.#n.length){const r=o,l={doWithData(){n(...r)},undoWithData(){i(...r)},cleanup(){n.cleanup&&n.cleanup(),i.cleanup&&i.cleanup()}};let s=this.#n[t];this.#n[t]=l,s?.cleanup()}}undo(){const t=this.#n.pop();t&&(t.undoWithData(),this.#i.unshift(t),fe(_.#t,_.#s))}removeLast(){const t=this.#n.pop();t&&(t.cleanup(),fe(_.#t,_.#a))}redo(){const t=this.#i.shift();t&&(t.doWithData(),this.#n.push(t),fe(_.#t,_.#d))}}const D=new _;D.onChange(function(e){D.undoAvailable?document.getElementById("btnUndo").removeAttribute("disabled"):document.getElementById("btnUndo").setAttribute("disabled",""),D.redoAvailable?document.getElementById("btnRedo").removeAttribute("disabled"):document.getElementById("btnRedo").setAttribute("disabled","")});function Yt(e,t){if(e===t)return e;if(!e||!t)return"";const n=e.length,i=t.length;let o=0;for(;o<n&&o<i&&e[o]===t[o];)++o;if(o===n)return e;if(o===i)return t;let r=0;for(;r<n&&r<i&&e[n-r-1]===t[i-r-1];)++r;if(r===n)return e;if(r===i)return t;o>n-r&&(r=n-o),o>i-r&&(r=i-o);const l=o===0&&r===0?e:e.substring(o,n-r),s=o===0&&r===0?t:t.substring(o,i-r);let a="";if(l&&s){const E=Array.from({length:l.length+1},()=>Array(s.length+1).fill(""));for(let c=1;c<=l.length;c++)for(let d=1;d<=s.length;d++)l[c-1]===s[d-1]?E[c][d]=E[c-1][d-1]+l[c-1]:E[c][d]=E[c-1][d].length>E[c][d-1].length?E[c-1][d]:E[c][d-1];a=E[l.length][s.length]}const f=o===0?"":e.substring(0,o),g=r===0?"":e.substring(n-r);return f+a+g}class te{static#t=0;static#e=1;static get DELETE(){return this.#t}static get INSERT(){return this.#e}static invert(t){return t+1&1}}function Le(e,t){if(e===t)return[];if(!e)return[{type:te.INSERT,text:t,index:0}];if(!t)return[{type:te.DELETE,text:e,index:0}];const n=Yt(e,t),i=[];let o=0,r=0,l=e;for(;r<n.length;){let s="",a=o;for(;l[o]!==n[r];)s+=l[o++];s&&(i.push({type:te.DELETE,text:s,index:a}),l=l.slice(0,a)+l.slice(a+s.length),o-=s.length),o++,r++}for(o<l.length&&(i.push({type:te.DELETE,text:l.slice(o),index:o}),l=l.slice(0,o)),o=0,r=0;r<n.length;){let s="",a=o;for(;t[o]!==n[r];)s+=t[o++];s&&(i.push({type:te.INSERT,text:s,index:a}),l=l.slice(0,a)+s+l.slice(a)),o++,r++}return o<t.length&&(i.push({type:te.INSERT,text:t.slice(o),index:l.length}),l=l+t.slice(o)),i}function Ae(e,t,n=!1){function i(o,r,l){switch(l?te.invert(r.type):r.type){case te.DELETE:o=o.slice(0,r.index)+o.slice(r.index+r.text.length);break;case te.INSERT:o=o.slice(0,r.index)+r.text+o.slice(r.index);break}return o}return n&&(t=t?.toReversed()),t?.forEach(o=>e=i(e,o,n)),e}class ee{static#t=0;static#e=1;static#o=2;static get CLOSED(){return this.#t}static get INITIALIZING(){return this.#e}static get RECORDING(){return this.#o}}const R={recordingState:ee.CLOSED,audioBlobs:[],mediaRecorder:null,streamBeingCaptured:null,isMediaRecordingSupported:function(){return!!(navigator?.mediaDevices&&navigator.mediaDevices.getUserMedia)},start:function(){return R.recordingState=ee.INITIALIZING,navigator?.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{R.streamBeingCaptured=e,R.mediaRecorder=new MediaRecorder(e),R.audioBlobs=[],R.mediaRecorder.addEventListener("dataavailable",t=>{R.audioBlobs.push(t.data)}),R.mediaRecorder.start(),R.recordingState=ee.RECORDING}):(R.recordingState=ee.CLOSED,Promise.reject(new Error("mediaDevices API or getUserMedia method is not supported in this browser.")))},stop:function(){return new Promise(e=>{const t=R.mediaRecorder.mimeType;R.mediaRecorder.addEventListener("stop",()=>{const n=new Blob(R.audioBlobs,{type:t});R.recordingState=ee.CLOSED,e(n),R.cancel()}),R.cancel()})},cancel:function(){R.mediaRecorder?.stop(),R.stopStream(),R.resetRecordingProperties()},stopStream:function(){R.streamBeingCaptured?.getTracks()?.forEach(e=>e.stop())},resetRecordingProperties:function(){R.mediaRecorder=null,R.streamBeingCaptured=null,R.recordingState=ee.CLOSED,R.audioBlobs=[]}},L=document.getElementById("editor"),me=document.getElementById("filename");function we(e){const t=window.getSelection(),n=document.createRange();return n.setStartAfter(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n}L.UNDO_STACK=D;const ve="justify-text",ut=["span","strong","em","u","s","a"],j=[{tagName:"span",style:{color:"var(--note-text-color-1)"},attributes:null},{tagName:"span",style:{color:"var(--note-text-color-2)"},attributes:null},{tagName:"span",style:{color:"var(--note-text-color-3)"},attributes:null},{tagName:"span",style:{color:"var(--note-text-color-4)"},attributes:null},{tagName:"span",style:{color:"var(--note-text-color-5)"},attributes:null},{tagName:"span",style:{color:"var(--note-text-color-6)"},attributes:null},{tagName:"span",style:{color:"var(--note-text-color-7)"},attributes:null},{tagName:"span",style:{color:"var(--note-text-color-8)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-1)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-2)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-3)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-4)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-5)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-6)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-7)"},attributes:null},{tagName:"span",style:{"background-color":"var(--note-highlight-color-8)"},attributes:null},{tagName:"span",style:{"font-size":"25%"},attributes:null},{tagName:"span",style:{"font-size":"33.33%"},attributes:null},{tagName:"span",style:{"font-size":"50%"},attributes:null},{tagName:"span",style:{"font-size":"66.66%"},attributes:null},{tagName:"span",style:{"font-size":"75%"},attributes:null},{tagName:"span",style:{"font-size":"125%"},attributes:null},{tagName:"span",style:{"font-size":"150%"},attributes:null},{tagName:"span",style:{"font-size":"175%"},attributes:null},{tagName:"span",style:{"font-size":"200%"},attributes:null},{tagName:"span",style:{"font-size":"250%"},attributes:null},{tagName:"span",style:{"font-size":"300%"},attributes:null},{tagName:"span",style:{"font-size":"350%"},attributes:null},{tagName:"strong",style:null,attributes:null},{tagName:"em",style:null,attributes:null},{tagName:"u",style:null,attributes:null},{tagName:"s",style:null,attributes:null}],je=8,Ge=8,qe=12,De=-1,Re=De+je,ke=Re+Ge,ft=ke+qe+1,mt=ft+1,gt=mt+1,pt=gt+1,Ze=pt,zt=[[De+1,De+je],[Re+1,Re+Ge],[ke+1,ke+qe]];function We(e){const t=new Set;for(e.querySelectorAll("a").forEach(n=>{n.hasAttribute("href")&&t.add(n.getAttribute("href"))});j[j.length-1].tagName==="a";)j.pop();for(let n of t)j.push({tagName:"a",style:null,attributes:{href:n}})}function Qe(e){const t=document.getElementById("toolbar");e?(L.contentEditable="true",me.contentEditable="plaintext-only",t.style.display="flex"):(L.contentEditable="false",me.contentEditable="false",t.style.display="none")}function Jt(e,t){const n=document.createElement("template");return n.innerHTML=e,n.content.querySelectorAll(".embedded-local-epub").forEach(i=>{i.replaceChildren(),t===!1&&i.setAttribute("data-readonly","true")}),t===!1&&(n.content.querySelectorAll(".x-remover, .top-container, .page-dropdown")?.forEach(i=>{i.parentNode?.removeChild(i)}),n.content.querySelectorAll('link[data-purpose="removable-style"]')?.forEach(i=>{i.remove()}),n.content.querySelectorAll(".content-editing-script")?.forEach(i=>{i.parentNode?.removeChild(i)}),n.content.querySelectorAll(".embedded-local-epub")?.length||n.content.querySelectorAll(".core-script, .epub-loading-script, .init-script")?.forEach(i=>{i.parentNode?.removeChild(i)}),n.content.querySelectorAll(".math-loading-script")?.forEach(i=>{i.parentNode?.removeChild(i)}),n.content.querySelectorAll(".embedded-math")?.length||n.content.querySelectorAll(".math-loading-style")?.forEach(i=>{i.parentNode?.removeChild(i)}),n.content.querySelectorAll(".recording-cancelled-container")?.forEach(i=>{i.parentNode&&i.parentNode.parentNode?.removeChild(i.parentNode)}),n.content.querySelectorAll("*[contenteditable]")?.forEach(i=>{i.setAttribute("contenteditable","false")}),[...n.content.getElementById("editor").children].forEach(i=>{i.hasAttribute("id")&&i.removeAttribute("id")})),n.innerHTML.split(/\r?\n/).filter(i=>i.trim()!=="").join(`
`)}class q{static#t=0;static#e=1;static#o=2;static get DOWNLOAD(){return this.#t}static get FILE(){return this.#e}static get SHARE(){return this.#o}}function Zt(e){const t={suggestedName:e,types:[{description:"Html file",accept:{"text/html":[".html"]}}]};return window.showSaveFilePicker?window.showSaveFilePicker(t):null}async function Q(e,t){let n=document.getElementById("filename").innerText.trim();if(!n){alert("Title is empty!");return}if(R.recordingState!==ee.CLOSED){alert("Stop recording before "+(e===q.SHARE?"sharing.":"saving."));return}t===!1?n=(n.endsWith(".html")?n.substring(0,n.length-5):n)+"_lock.html":n=n.endsWith(".html")?n:n+".html",t===!1&&Qe(!1);const i=document.getElementById("noteDates");if(i){const a=new Date(Date.parse(i.getAttribute("data-created-time"))),f=new Date;i.setAttribute("data-last-saved-time",`${f.toISOString()}`),ct(i,a,f)}const o=Jt(document.documentElement.outerHTML,t);let r=o.indexOf('<div class="editor-container">');for(;r>0&&(o[r-1]===" "||o[r-1]==="	");)r--;const l=new Blob([`<!DOCTYPE html>
<html>
`+(r>-1?`<head>
`+o.substring(0,r):o)+(r>-1?`</head>
<body>
`+o.substring(r)+`
</body>`:"")+`
</html>`],{type:"text/html"}),s=new File([l],n,{type:"text/html"});switch(t===!1&&Qe(!0),e){case q.DOWNLOAD:let a=document.createElement("a");a.href=URL.createObjectURL(l),a.download=n,a.click(),URL.revokeObjectURL(a.href);break;case q.FILE:let f=null;try{const g=Zt(n);if(!g){alert("Feature not supported in this browser.");return}f=await(await g).createWritable(),await f.write(l),await f.close()}catch(g){if(console.error("save to file failed:",g),f)try{await f.close()}catch(E){console.error("closing the file failed:",E)}}break;case q.SHARE:if(navigator.canShare&&navigator.canShare({files:[s]}))try{await navigator.share({files:[s],title:n,text:""})}catch(g){console.error("share failed:",g)}break}}function X(e,t){if(e!==t)for(;e&&e.parentNode!==t;)e=e.parentNode;return e?.parentNode===t?e:null}function W(e=null){let t=e;if(!t){let n=window.getSelection();n?.rangeCount&&(t=n.getRangeAt(0))}return X(t?.startContainer,L)}function ge(e){return new Promise((t,n)=>setTimeout(function(){t(prompt(e))},10))}function Et(e){const t=e.target.files[0];if(t){let n=new FileReader;const i=W(Y)?.nextElementSibling;n.onload=function(o){const r=document.createElement("div"),l=document.createElement("img");l.src=o.target.result,r.appendChild(l),r.appendChild(Z()),r.setAttribute("id",`img${$()}`),r.setAttribute("class","embedded-local-image"),r.setAttribute("contenteditable","false"),D.push(U,G,r,i?.id)},n.readAsDataURL(t)}}async function bt(){const e=(await ge("Image URL"))?.trim();if(!e)return;const t=W()?.nextElementSibling,n=document.createElement("div"),i=document.createElement("img");i.src=`${e}`,n.appendChild(i),n.appendChild(Z()),n.setAttribute("id",`img${$()}`),n.setAttribute("class","image-link"),n.setAttribute("contenteditable","false"),D.push(U,G,n,t?.id)}function ht(e){const t=e.target.files[0];if(t){let n=new FileReader;const i=W(Y)?.nextElementSibling;n.onload=function(o){const r=document.createElement("div"),l=document.createElement("audio");l.src=o.target.result,l.setAttribute("controls",""),r.appendChild(l),r.appendChild(Z()),r.setAttribute("id",`audio${$()}`),r.setAttribute("class","embedded-local-audio"),r.setAttribute("contenteditable","false"),D.push(U,G,r,i?.id)},n.readAsDataURL(t)}}async function At(){const e=(await ge("Audio URL"))?.trim();if(!e)return;const t=W()?.nextElementSibling,n=document.createElement("div"),i=document.createElement("audio");i.src=`${e}`,i.setAttribute("controls",""),n.appendChild(i),n.appendChild(Z()),n.setAttribute("id",`audio${$()}`),n.setAttribute("class","audio-link"),n.setAttribute("contenteditable","false"),D.push(U,G,n,t?.id)}async function Tt(){const e=(await ge("Video URL"))?.trim();if(!e)return;const t=W()?.nextElementSibling,n=document.createElement("div"),i=document.createElement("video");i.src=`${e}`,i.setAttribute("controls",""),n.appendChild(i),n.appendChild(Z()),n.setAttribute("id",`video${$()}`),n.setAttribute("class","video-link"),n.setAttribute("contenteditable","false"),D.push(U,G,n,t?.id)}const N={strArId:null,audioRecordingNode:null,nextSibling:null,elapsedTimeTag:null,audioRecordStartTime:null,maximumRecordingTimeInHours:1,elapsedTimeTimer:null,undoStackIndex:-1,reset:function(){N.strArId=null,N.audioRecordingNode=null,N.nextSibling=null,N.elapsedTimeTag=null,N.audioRecordStartTime=null,N.elapsedTimeTimer=null,N.undoStackIndex=-1},insert:function(e){if(!R.isMediaRecordingSupported()){console.log("Media recording is not supported in this browser."),alert("Media recording is not supported in this browser.");return}if(R.recordingState!==ee.CLOSED){alert("A recording is already in progress.");return}N.reset(),N.nextSibling=W(e)?.nextElementSibling,N.strArId=`ar${$()}`,N.audioRecordingNode=document.createElement("div"),N.audioRecordingNode.setAttribute("id",N.strArId),N.audioRecordingNode.setAttribute("class","audio-recording"),N.audioRecordingNode.setAttribute("contenteditable","false");const t=document.createElement("div");t.setAttribute("class","recording-control-buttons-container non-selectable"),t.setAttribute("contenteditable","false"),t.innerHTML=`
            <button class="cancel-recording-button non-selectable" contenteditable="false">âœ–</button>
            <div class="recording-elapsed-time non-selectable" contenteditable="false">
              <b class="red-recording-dot non-selectable" contenteditable="false" aria-hidden="true">ðŸ”´</b>
              <p class="elapsed-time non-selectable" style="font-size: 28px;" contenteditable="false">00:00</p>
            </div>
            <button class="stop-recording-button non-selectable" contenteditable="false">âœ“</button>`,N.audioRecordingNode.appendChild(t),R.recordingState===ee.CLOSED?N.startAudioRecording():N.reset()},startAudioRecording:function(){console.log("Recording Audio...");const e=document.querySelectorAll("audio");for(let t of e)t.paused||t.pause();if(R.recordingState!==ee.CLOSED){N.reset();return}R.start().then(()=>{N.audioRecordStartTime=new Date;const t=N.audioRecordingNode,n=N.nextSibling;N.undoStackIndex=D.push(U,function(r,l){N.onClickCancelAudioRecording()},t,n?.id),N.elapsedTimeTag=document.querySelectorAll(`#${N.strArId} .elapsed-time`)[0];const i=document.querySelectorAll(`#${N.strArId} .stop-recording-button`)[0],o=document.querySelectorAll(`#${N.strArId} .cancel-recording-button`)[0];i.onclick=N.stopAudioRecording,o.onclick=N.onClickCancelAudioRecording,N.handleElapsedRecordingTime()}).catch(t=>{switch(t.message.includes("mediaDevices API or getUserMedia method is not supported in this browser.")&&(console.log("To record audio, use browsers like Chrome and Firefox."),alert("To record audio, use browsers like Chrome and Firefox.")),t.name){case"AbortError":console.log("An AbortError has occured.");break;case"NotAllowedError":console.log("A NotAllowedError has occured. User might have denied permission.");break;case"NotFoundError":console.log("A NotFoundError has occured.");break;case"NotReadableError":console.log("A NotReadableError has occured.");break;case"SecurityError":console.log("A SecurityError has occured.");break;case"TypeError":console.log("A TypeError has occured.");break;case"InvalidStateError":console.log("An InvalidStateError has occured.");break;case"UnknownError":console.log("An UnknownError has occured.");break;default:console.log("An error occured with the error name "+t.name)}N.cancelAudioRecording()})},stopAudioRecording:function(){console.log("Stopping Audio Recording..."),R.stop().then(e=>{N.handleRecordingEnd(),N.showAudioPlay(e)}).catch(e=>{switch(e.name){case"InvalidStateError":console.log("An InvalidStateError has occured.");break;default:console.log("An error occured with the error name "+e.name)}N.cancelAudioRecording()})},cancelAudioRecording:function(){console.log("Canceling audio..."),R.cancel(),N.handleRecordingEnd();const e=N.audioRecordingNode,t=N.nextSibling;e.innerHTML='<div class="recording-cancelled-container" contenteditable="false"><span style="margin: 0 10px">Cancelled audio recording</span></div>',e.appendChild(Z()),D.replace(N.undoStackIndex,U,G,e,t?.id),N.reset()},onClickCancelAudioRecording:function(){confirm("Do you want to cancel audio recording? The cancellation cannot be undone.")&&N.cancelAudioRecording()},showAudioPlay:function(e){let t=new FileReader;t.onload=n=>{const i=N.audioRecordingNode,o=N.nextSibling;i.innerHTML=`<audio controls src="${n.target.result}"></audio>`,i.appendChild(Z()),D.replace(N.undoStackIndex,U,G,i,o?.id),document.querySelectorAll(`#${N.strArId} audio`)[0].load(),N.reset()},t.readAsDataURL(e)},hideRecordingStatusBar:function(){document.getElementById("editorContainer").classList.add("thin-line"),document.getElementById("recordingBar").classList.add("hidden")},recordingDotShowingInViewport:function(){const e=document.querySelectorAll(".audio-recording .red-recording-dot")[0],t=document.getElementById("toolbar"),n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),o=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight;return n.top+11<r&&n.bottom-6>i.bottom&&n.left<o&&n.left>-n.width},showRecordingStatusBar:function(){N.recordingDotShowingInViewport()?N.hideRecordingStatusBar():(document.getElementById("editorContainer").classList.remove("thin-line"),document.getElementById("recordingBar").classList.remove("hidden"))},handleElapsedRecordingTime:function(){N.displayElapsedTimeDuringAudioRecording("00:00"),N.showRecordingStatusBar(),document.addEventListener("scroll",N.showRecordingStatusBar),N.elapsedTimeTimer=setInterval(()=>{const e=N.computeElapsedTime(N.audioRecordStartTime);N.displayElapsedTimeDuringAudioRecording(e)},1e3)},displayElapsedTimeDuringAudioRecording:function(e){N.elapsedTimeTag.innerHTML=e,N.elapsedTimeReachedMaximumNumberOfHours(e)?N.stopAudioRecording():N.showRecordingStatusBar()},elapsedTimeReachedMaximumNumberOfHours:function(e){const t=e.split(":"),n="0"+N.maximumRecordingTimeInHours;return t.length===3&&t[0]===n},computeElapsedTime:function(e){let n=new Date-e;n=n/1e3;let i=Math.floor(n%60);i=i<10?"0"+i:i,n=Math.floor(n/60);let o=n%60;o=o<10?"0"+o:o,n=Math.floor(n/60);let r=n%24;n=Math.floor(n/24);let s=r+n*24;return s=s<10?"0"+s:s,s==="00"?o+":"+i:s+":"+o+":"+i},handleRecordingEnd:function(){N.elapsedTimeTimer&&(clearInterval(N.elapsedTimeTimer),N.elapsedTimeTimer=null,console.log("Recording timer stopped.")),N.hideRecordingStatusBar(),document.removeEventListener("scroll",N.showRecordingStatusBar)}};function Qt(){N.insert(Y)}function yt(e,t){const n=document.getElementById(e),i=n?.querySelector("math");i&&(n.setAttribute("data-math",t),mathup(t,{bare:!0}).updateDOM(i))}function en(e,t,n){yt(e,n)}function tn(e,t,n){yt(e,t)}function Ct(e){let t=e.target;for(;t&&!t.classList?.contains("embedded-math");)t=t.parentNode;if(!t?.id)return!1;const n=t.getAttribute("data-math"),i=prompt("Introduce math expression (see https://mathup.xyz):",n)?.trim();return!i||n===i?!1:(D.push(en,tn,t.id,n,i),!0)}function St(){const e=prompt("Introduce math expression (see https://mathup.xyz):")?.trim();if(!e)return;const t=W()?.nextElementSibling,n=document.createElement("div"),i=mathup(e,{bare:!1,display:"block"}).toDOM();i.addEventListener("click",Ct),n.appendChild(i),n.appendChild(Z()),n.setAttribute("id",`math${$()}`),n.setAttribute("class","embedded-math"),n.setAttribute("contenteditable","false"),n.setAttribute("data-math",e),D.push(U,G,n,t?.id)}function Nt(e,t=null){const n=e.target.files[0];if(n){let i=new FileReader;const o=W(Y)?.nextElementSibling;i.onload=async function(r){Xt(r.target?.result,o)},i.readAsDataURL(n)}}function Lt(e,t=null){const n=e.target.files[0];if(n){let i=new FileReader;const o=W(Y)?.nextElementSibling;i.onload=async function(r){await nn(r.target?.result,o)},i.readAsDataURL(n)}}async function nn(e,t,n=null){if(e){let s=function(a){o.classList.remove("pdf-loading"),l.removeEventListener("load",s)};var i=s;n?.replaceChildren();const o=n||document.createElement("div");o.getAttribute("id")||o.setAttribute("id",`pdf${$()}`),o.setAttribute("class","embedded-local-pdf pdf-loading"),o.setAttribute("contenteditable","false"),n||D.push(U,G,o,t?.id);const l=PDFObject.embed(e,o,{height:"800px",pdfOpenParams:{navpanes:1,view:"FitH",pagemode:"thumbs"}});l.addEventListener("load",s),o.appendChild(Z())}}async function vt(){const e=(await ge("PDF URL"))?.trim();if(!e)return;const t=W()?.nextElementSibling,n=document.createElement("div");n.setAttribute("id",`pdf${$()}`),n.setAttribute("class","pdf-link pdf-loading"),n.setAttribute("contenteditable","false"),D.push(U,G,n,t?.id);const i=PDFObject.embed(e,n,{height:"800px",pdfOpenParams:{navpanes:1,view:"FitH",pagemode:"thumbs"}});function o(r){n.classList.remove("pdf-loading"),i.removeEventListener("load",o)}i.addEventListener("load",o),n.appendChild(Z())}async function _e(e){const t=(await ge((e?"Headless table":"Table")+" rows and columns"))?.trim();if(!t)return;let n=-1,i=-1,o=-1,r=-1,l=0,s=t.length;for(;l<s;){if(t[l]>="0"&&t[l]<="9"){if(n<0){n=l++;continue}if(i>-1&&o<0){o=l++;continue}}else if(n>-1){if(i<0){i=l++;continue}if(o>-1&&r<0){r=l++;break}}++l}if(n<0||i<0||n===i||o<0||o===r){alert("Invalid input.");return}r<0&&(r=s);let a=parseInt(t.substring(n,i));const f=parseInt(t.substring(o,r));if(a<1||f<1){alert("Invalid input.");return}let g="";if(!e){--a;for(let A=0;A<f;++A)g+=`
<th scope="col" contenteditable="true">Column ${A+1}</th>`;g=`<thead>
<tr>`+g+`
</tr>
</thead>`}let E="";for(let A=0;A<a;++A){let T="";for(let M=0;M<f;++M)T+=`
<td contenteditable="true"><br/></td>`;T="<tr>"+T+`
</tr>`,E+=`
${T}`}E=E?"<tbody>"+E+`
</tbody>`:"";const c=W()?.nextElementSibling,d=document.createElement("div");d.setAttribute("id",`table${$()}`),d.setAttribute("class","embedded-table"),d.setAttribute("contenteditable","false"),d.innerHTML=['<table contenteditable="false">',g,E,"</table>"].join(`
`),D.push(U,G,d,c?.id),d.appendChild(Z())}function on(){const e=W(),t=document.createElement("p");t.setAttribute("id",`text${$()}`),t.setAttribute("class",`text-block ${ve}`),t.appendChild(document.createElement("br")),D.push(U,G,t,e?.nextElementSibling?.id),oe(t,0)}function rn(){const e=W()?.nextElementSibling,t=document.createElement("div"),n=document.createElement("pre"),i=document.createElement("code");i.setAttribute("contenteditable","plaintext-only"),i.appendChild(document.createElement("br")),n.appendChild(i),t.appendChild(n),t.setAttribute("id",`code${$()}`),t.setAttribute("class","code-block"),t.setAttribute("contenteditable","true"),D.push(U,G,t,e?.id),oe(i,0)}async function It(){const e=(await ge("Embedded Page (iframe or URL)"))?.trim();if(!e)return;const t=W()?.nextElementSibling,n=document.createElement("div");e.length<7||!e.toUpperCase().startsWith("<IFRAME")?n.innerHTML=`<iframe src="${e}" allow="fullscreen" width="100%" height="400"></iframe>`:n.innerHTML=`${e}`,n.setAttribute("id",`embed${$()}`),n.setAttribute("class","embedded-content"),n.setAttribute("contenteditable","false"),D.push(U,G,n,t?.id),n.appendChild(Z())}class le{static#t=0;static#e=1;static#o=2;static#l=3;static get LEFT(){return this.#t}static get CENTER(){return this.#e}static get RIGHT(){return this.#o}static get JUSTIFY(){return this.#l}}const ye=[["left-text","left-align"],["center-text","center-align"],["right-text","right-align"],["justify-text","justify-align"]],Ue=ye.flat();function se(e){const t=window.getSelection();if(!t.rangeCount)return;const n=t.getRangeAt(0),i=[],o=["text-block","embedded-table","embedded-content","embedded-math","embedded-local-image","image-link"];function r(c){const d=[];for(let A of Ue)c.classList?.contains(A)&&d.push(A);return d}function l(c,d){c.classList?.remove(...Ue);for(let A of d)c.classList?c.classList.add(A):c.setAttribute("class",A)}function s(c,d){c.classList?.remove(...Ue),c.classList?c.classList.add(d):c.setAttribute("class",d)}function a(c){c.forEach(d=>{const A=document.getElementById(d.id);if(A)if(A.classList?.contains("text-block"))d.alignments=r(A);else if(A.classList?.contains("embedded-table")){d.alignments=new Map;for(let T of d.idx){const M=[];A.querySelectorAll(`tr th:nth-child(${T}), tr td:nth-child(${T})`)?.forEach(b=>{M.push(r(b))}),d.alignments.set(T,M)}}else A.firstElementChild&&(d.alignments=r(A))})}function f(c,d){if(c.classList?.contains("embedded-table")){const A=new Set;return ye[e][0],c.querySelectorAll("th, td").forEach(T=>{if(d.intersectsNode(T)){let M=1;const b=T.nodeName;for(;T.previousSibling;)T=T.previousSibling,T.nodeName===b&&++M;A.add(M)}}),[...A]}return[]}function g(c,d){c.forEach(A=>{const T=document.getElementById(A.id);if(T)if(T.classList?.contains("text-block"))s(T,ye[d][0]);else if(T.classList?.contains("embedded-table"))for(let M of A.idx)T.querySelectorAll(`tr th:nth-child(${M}), tr td:nth-child(${M})`)?.forEach(b=>{s(b,ye[d][0])});else T.firstElementChild&&s(T,ye[d][1])})}function E(c,d){c.forEach(A=>{const T=document.getElementById(A.id);if(T)if(T.classList?.contains("text-block"))l(T,A.alignments);else if(T.classList?.contains("embedded-table"))for(let M of A.idx){const b=A.alignments.get(M);let v=0;T.querySelectorAll(`tr th:nth-child(${M}), tr td:nth-child(${M})`)?.forEach(m=>{l(m,b[v++])})}else T.firstElementChild&&l(T,A.alignments)})}if(n){if(n.commonAncestorContainer.nodeType===Node.TEXT_NODE){const c=X(n.startContainer,L);c?.classList&&[...c.classList].some(d=>o.indexOf(d)>-1)&&i.push({id:c.id,idx:f(c,n)})}else{let c=X(n.startContainer,L),d=X(n.endContainer,L);for(;c;){if(c.classList&&[...c.classList].some(A=>o.indexOf(A)>-1)&&i.push({id:c.id,idx:f(c,n)}),c===d){d=null;break}c=c.nextElementSibling}for(;d&&(d.classList&&[...d.classList].some(A=>o.indexOf(A)>-1)&&i.push({id:d.id,idx:f(d,n)}),c!==d);)d=d.previousElementSibling}a(i),i.length>0&&D.push(g,E,i,e)}}function S(e){const t=document.getElementById(e);t.classList.contains("show")?t.classList.remove("show"):(document.querySelectorAll(".dropdown-content, .text-dropdown-content, .page-dropdown").forEach(n=>n.classList.remove("show")),t.classList.add("show"))}document.addEventListener("click",function(e){e.target.closest(".dropdown")||document.querySelectorAll(".dropdown-content").forEach(t=>t.classList.remove("show")),e.target.closest(".text-dropdown")||document.querySelectorAll(".text-dropdown-content").forEach(t=>t.classList.remove("show")),!e.target.closest(".page-dropdown-toolbar-item")&&!e.target.closest(".page-dropdown-header")&&document.querySelectorAll(".page-dropdown").forEach(t=>t.classList.remove("show"))});class Ee{#t=0;#e;constructor(t){this.#t=t,this.#e=new Uint32Array(Math.ceil(t/32)).fill(0)}get length(){return this.#t}get isZero(){const t=this.#e.length;for(let n=0;n<t;++n)if(this.#e[n]!==0)return!1;return!0}identical(t){if(this.#e.length===t.#e.length){const n=this.#e.length;for(let i=0;i<n;++i)if(this.#e[i]!==t.#e[i])return!1;return!0}return!1}clone(){const t=new Ee(this.#t);return t.#e=Uint32Array.from(this.#e),t}set(t){const n=Math.floor(t/32),i=t%32;this.#e[n]=this.#e[n]|1<<i}clear(t){const n=Math.floor(t/32),i=t%32;this.#e[n]=this.#e[n]&~(1<<i)}setValue(t,n){n?set(t):clear(t)}get(t){const n=Math.floor(t/32),i=t%32;return(this.#e[n]&1<<i)!=0}bitOrAssign(t){const n=Math.min(this.#e.length,t.#e.length);for(let i=0;i<n;++i)this.#e[i]|=t.#e[i];return this}bitOr(t){return this.clone().bitOrAssign(t)}bitAndAssign(t){const n=Math.min(this.#e.length,t.#e.length);for(let i=0;i<n;++i)this.#e[i]&=t.#e[i];return this}bitAnd(t){return this.clone().bitAndAssign(t)}invertAssign(){const t=this.#e.length;for(let n=0;n<t;++n)this.#e[n]=~this.#e[n];return this}invert(){return this.clone().invertAssign()}}function P(e){return e?e.nodeType===Node.TEXT_NODE||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.textContent??"":e.nodeName==="BR"?`
`:e.innerText??"":""}function z(e){const t=new Map;let n=P(e);t.set(e,{start:0,end:n.length});const i=[];for(e=e.hasChildNodes?e.firstChild:null;e;){if(e.nodeType===Node.ELEMENT_NODE&&e.hasChildNodes&&i.push(...e.childNodes),e.nodeType===Node.ELEMENT_NODE||e.nodeType===Node.TEXT_NODE){let o=e.previousSibling;for(;o&&!t.has(o);)o=o.previousSibling;n=P(e);const r=o?t.get(o).end:t.get(e.parentNode).start,l=r+n.length;for(t.set(e,{start:r,end:l});e.nextSibling&&e.nextSibling.nodeType!==Node.TEXT_NODE&&e.nextSibling.nodeType!==Node.ELEMENT_NODE;)e=e.nextSibling}e=e.nextSibling??(i.length>0?i.shift():null)}return t}function Se(e,t,n,i){const o=e.split(`
`);for(let r=0;r<o.length;r++)o[r]=document.createTextNode(o[r]);for(let r=o.length-1;r>0;r--)o.splice(r,0,document.createElement("br"));if(t>-1||n>-1){let r=0,l=null,s=null,a=0,f=0;for(let g=0;g<o.length;g++){const E=o[g].nodeName==="BR"?1:o[g].textContent.length;r<=t&&t<r+E&&(l=o[g],a=t-r),r<n&&n<=r+E&&(s=o[g],f=n-r),r+=E}i(l,s,a,f)}return o}function Xe(e,t){function n(m,p,u,y){if(m?.nodeName===p){let C=!0;if(u){for(let h in u)if(m.style[h]!==u[h]){C=!1;break}}let w=!0;if(y){for(let h in y)if((!m.hasAttribute(h)||!m.getAttribute(h))&&y[h]||m.getAttribute(h)!==y[h]){w=!1;break}}if(C&&w)return!0}return!1}function i(m,p,u){const y=new Array(u+1);for(let h=0;h<u+1;h++)y[h]=new Ee(p.length);const C=new Int32Array(u+1);let w=0;for(const h of p){const I=new Ee(p.length);I.set(w++);const k=m.entries().filter(([O,x])=>n(O,h.tagName.toUpperCase(),h.style,h.attributes));C.fill(0);for(const[O,x]of k)C[x.start]+=1,C[x.end]-=1;for(let O=0;O<C.length-1;++O)C[O+1]+=C[O],C[O]&&y[O].bitOrAssign(I)}return y}function o(m){return m&&(m.nodeName==="P"||he(m.parentNode))}function r(m,p){const u=[];if(p)if(p.commonAncestorContainer.nodeType===Node.TEXT_NODE){const y=X(p.startContainer,m);if(y){const C=z(y),w=C.get(p.startContainer).start+p.startOffset,h=w+p.endOffset-p.startOffset;u.push({node:y,start:w,end:h,positions:C})}}else{let y=X(p.startContainer,m),C=X(p.endContainer,m);const w=y,h=C;for(;y&&y!==C&&!o(y);)y=y.nextSibling;for(;C&&y!==C&&!o(C);)C=C.previousSibling;if(y&&C)if(y===C){const I=z(y),k=w===y?I.get(p.startContainer).start+p.startOffset:I.get(y).start,O=h===C?I.get(p.endContainer).start+p.endOffset:I.get(C).end;u.push({node:y,start:k,end:O,positions:I})}else{let I=z(y),k=w===y?I.get(p.startContainer).start+p.startOffset:I.get(y).start,O=I.get(y).end;u.push({node:y,start:k,end:O,positions:I});let x=y.nextSibling;for(;x&&x!==C;)x.parentNode===m&&o(x)&&(I=z(x),k=I.get(x).start,O=I.get(x).end,u.push({node:x,start:k,end:O,positions:I})),x=x.nextSibling;I=z(C),k=I.get(C).start,O=h===C?I.get(p.endContainer).start+p.endOffset:I.get(C).end,u.push({node:C,start:k,end:O,positions:I})}}return u}function l(m,p){for(let u in p)m.style[u]=p[u]}function s(m,p,u,y,C){let w=null,h=null,I=0,k=0;function O(x,F,B,K){w||(w=x,I=B),h||(h=F,k=K)}if(u.isZero)m.append(...Se(p,y,C,O));else{for(let x=0;x<u.length;++x)if(u.get(x)){const F=document.createElement(j[x].tagName);if(j[x].style&&l(F,j[x].style),j[x].attributes)for(let B in j[x].attributes)F.setAttribute(B,j[x].attributes[B]);m.appendChild(F),m=F}m.append(...Se(p,y,C,O))}return[w,h,I,k]}function a(m,p,u,y){const C=P(m),w=C.length;let h=0;const I=document.createDocumentFragment();let k=null,O=null,x=0,F=0;for(let B=1;B<w;++B)if(!p[B].identical(p[h])){const K=h<=u&&u<B?u-h:-1,V=h<y&&y<=B?y-h:-1,[ae,ce,pe,Ie]=s(I,C.substring(h,B),p[h],K,V);h=B,k||(k=ae,x=pe),O||(O=ce,F=Ie)}if(h<w){const B=h<=u&&u<w?u-h:-1,K=h<y&&y<=w?y-h:-1,[V,ae,ce,pe]=s(I,C.substring(h),p[h],B,K);k||(k=V,x=ce),O||(O=ae,F=pe)}return m.nodeType===Node.ELEMENT_NODE?m.replaceChildren(I):m.nodeType===Node.TEXT_NODE&&m.replaceWith(I),[k,O,x,F]}if(!e){const m=window.getSelection();m?.rangeCount&&(e=m.getRangeAt(0))}if(!e)return;let f=e.commonAncestorContainer,g=L;for(;f&&f!==g;){if(he(f)){g=f.parentNode;break}f=f.parentNode}const E=r(g,e),c=[];let d=!0;const A=new Ee(j.length);A.set(t);for(let m of E){const p=i(m.positions,j,m.positions.get(m.node).end);delete m.positions;for(let u=m.start;u<m.end;++u)p[u].bitAnd(A).isZero&&(d=!1);c.push(p)}function T(m){const p=new Array(m.length);for(let u=0;u<m.length;u++){p[u]=new Array(m[u].length);for(let y=0;y<m[u].length;y++)p[u][y]=m[u][y].clone()}return p}function M(m,p,u,y){const C=[];if(p=T(p),y){u=u.invert();for(let w=0;w<m.length;++w){const h=p[w];for(let K=m[w].start;K<m[w].end;++K)h[K].bitAndAssign(u);const I=w==0?m[w].start:-1,k=w==m.length-1?m[w].end:-1,[O,x,F,B]=a(m[w].node,h,I,k);(O||x)&&C.push([O,x,F,B])}}else{let w=null;for(let h of zt)if(t>=h[0]&&t<=h[1]){w=new Ee(j.length);for(let I=h[0];I<=h[1];I++)w.set(I);w.invertAssign(),w.set(t);break}for(let h=0;h<m.length;++h){const I=p[h];for(let V=m[h].start;V<m[h].end;++V)w&&I[V].bitAndAssign(w),I[V].bitOrAssign(u);const k=h==0?m[h].start:-1,O=h==m.length-1?m[h].end:-1,[x,F,B,K]=a(m[h].node,I,k,O);(x||F)&&C.push([x,F,B,K])}}if(window.getSelection().removeAllRanges(),C.length){const w=document.createRange();w.setStart(C[0][0],C[0][2].nodeName==="BR"?0:C[0][2]);const h=C.length>1?1:0;w.setEnd(C[h][1],C[h][1].nodeName==="BR"?0:C[h][3]),window.getSelection().addRange(w)}}function b(m,p,u,y){M(m,p,u,y)}function v(m,p,u,y){M(m,p,u,!y)}E.length>0&&D.push(b,v,E,c,A,d)}function He(e){const t=window.getSelection();if(!t.rangeCount||t.isCollapsed)return;const n=t.getRangeAt(0);L.contains(n.commonAncestorContainer)&&(We(L),Xe(n,e))}function Ve(e){const t=window.getSelection();if(!t.rangeCount||t.isCollapsed)return;const n=t.getRangeAt(0);L.contains(n.commonAncestorContainer)&&(We(L),Xe(n,e))}async function wt(){const e=window.getSelection();if(!e.rangeCount||e.isCollapsed)return;const t=e.getRangeAt(0);if(!L.contains(t.commonAncestorContainer))return;const n=(await ge("URL"))?.trim();if(!n)return;We(L);let i=j.length-1;for(;i>Ze&&!(j[i].tagName==="a"&&j[i].attributes&&j[i].attributes.href===n);i--);i<=Ze&&(j.push({tagName:"a",style:null,attributes:{href:n}}),i=j.length-1),Xe(t,i)}function et(e){e&&Ve(ke+e)}function tt(e){e&&Ve(De+e)}function nt(e){e&&Ve(Re+e)}function ln(e,t,n){for(let i=0;i<e.length;++i){const o=e[i],r=document.getElementById(o);if(r){const l=t[i];r.classList?.contains(l)&&r.classList.remove(l),n!=="medium-text"&&r.classList?.add(n)}}}function sn(e,t,n){for(let i=0;i<e.length;++i){const o=e[i],r=document.getElementById(o);if(r){r.classList?.contains(n)&&r.classList.remove(n);const l=t[i];l!=="medium-text"&&r.classList?.add(l)}}}const dn=["xlarge-text","large-text","medium-text","small-text"];function de(e){const t=window.getSelection();if(!t.rangeCount)return;const n=t.getRangeAt(0),i=[];function o(l){const s=["xlarge-text","large-text","small-text"];return l?.classList?.contains("text-block")&&(e==="medium-text"?[...l.classList].some(a=>s.indexOf(a)>-1):!l.classList.contains(e))}function r(l){for(let s of dn)if(l.classList.contains(s))return s;return"medium-text"}if(n){if(n.commonAncestorContainer.nodeType===Node.TEXT_NODE){const d=X(n.startContainer,L);o(d)&&i.push(d.id)}else{let d=X(n.startContainer,L),A=X(n.endContainer,L);for(;d;){if(o(d)&&i.push(d.id),d===A){A=null;break}d=d.nextElementSibling}for(;A&&(o(A)&&i.push(A.id),d!==A);)A=A.previousElementSibling}const l=n.startContainer,s=n.endContainer,a=l.id,f=s.id,g=n.startOffset,E=n.endOffset,c=i.map(d=>r(document.getElementById(d)))??[];i.length>0&&D.push(ln,sn,i,c,e),n.setStart(a?document.getElementById(a):l,g),n.setEnd(f?document.getElementById(f):s,E),t.removeAllRanges(),t.addRange(n)}}function Be(e){if(!e)return e;for(;e.lastChild;){for(e=e.lastChild;e.previousSibling&&e.nodeType===Node.TEXT_NODE&&!e.textContent.length;)e=e.previousSibling;if(e.nodeName==="BR")break}return e}function Ne(e){if(!e)return-1;let t=0;for(;e.previousSibling;)++t,e=e.previousSibling;return t}function it(e){if(!e)return-1;let t=0,n=e.nodeName;for(;e.previousElementSibling;)e.previousElementSibling.nodeName===n&&++t,e=e.previousElementSibling;return t}function ot(e,t,n){if(e.nodeType===Node.TEXT_NODE)return(n.has(e)?n.get(e).start:0)+t;if(e.nodeType===Node.ELEMENT_NODE){let i=e.firstChild,o=0,r=n.has(e)?n.get(e).start:0;for(;i&&o<t;)n.has(i)&&(r=n.get(i).end),i=i.nextSibling,++o;return r}return 0}function ne(e,t){const n=z(e),i=ot(t.startContainer,t.startOffset,n),o=ot(t.endContainer,t.endOffset,n);return{start:i,end:o}}function re(e,t){e.classList?.contains("code-block")&&(e=e.querySelector("code"));const n=z(e);let i=null,o=-1,r=null,l=-1;const s=[{node:e,visit:0}];for(;s.length>0;){const a=s.pop();if(a.visit<1&&a.node.hasChildNodes)a.visit++,s.push(a),s.push(...[...a.node.childNodes].map(f=>({node:f,visit:0})));else if(n.has(a.node)){const f=n.get(a.node);(a.node.nodeType===Node.TEXT_NODE&&P(a.node)||a.node.nodeName==="BR")&&((f.start===t.start||f.start<t.start&&t.start<f.end)&&(a.node.nodeName==="BR"?(i=a.node.parentNode,o=Ne(a.node)):(i=a.node,o=t.start-f.start)),(f.start===t.end&&t.start===t.end||f.start<t.end&&t.end<=f.end)&&(a.node.nodeName==="BR"?(r=a.node.parentNode,l=Ne(a.node)+(f.start===t.end?0:1)):(r=a.node,l=t.end-f.start)))}}if(i||r){const a=document.createRange();return i&&a.setStart(i,o),r&&a.setEnd(r,l),i||a.setStart(r,l),r||a.setEnd(i,o),window.getSelection().removeAllRanges(),window.getSelection().addRange(a),a}return null}function an(e,t,n,i){const o=document.getElementById(t);if(!o)return;const r=Ae(o.innerHTML,n);o.innerHTML!==r&&(o.innerHTML=r),U(e,o.nextElementSibling?.id)}function cn(e,t,n,i){const o=document.getElementById(t);if(!o)return;G(e,null);const r=Ae(o.innerHTML,n,!0);o.innerHTML!==r&&(o.innerHTML=r),re(o,i)}function un(e){if(!e||!window.getSelection().isCollapsed)return;let t=e.startContainer;for(;t&&t.parentNode!==L;)t=t.parentNode;if(!t){const E=document.createElement("p");E.setAttribute("id",`text${$()}`),E.setAttribute("class",`text-block ${ve}`),E.innerHTML="<br/>",D.push(U,G,E,null);return}const n=t.innerHTML,i=ne(t,e),o=t.classList?.contains("text-block"),r=document.createElement(o?t.nodeName.toLowerCase():"p");r.setAttribute("id",`text${$()}`),r.setAttribute("class",o?t.getAttribute("class"):"text-block");const l=e.startContainer,s=e.cloneRange();s.setEndAfter(t.lastChild||t);const a=s.extractContents();if(!a.childNodes.length)r.innerHTML="<br/>";else{r.appendChild(a);const E=Be(r);E?.nodeName!=="BR"&&(E.nodeType===Node.ELEMENT_NODE?E.appendChild(document.createElement("br")):E.nodeType===Node.TEXT_NODE?E.parentNode.nodeName!=="BR"?E.parentNode.appendChild(document.createElement("br")):E.parentNode.parentNode.appendChild(document.createElement("br")):r.appendChild(document.createElement("br")))}const f=Be(t);(f.nodeName!=="BR"||f!==l)&&(f.nodeType===Node.TEXT_NODE||f.nodeName==="BR"?f.parentNode.nodeName!=="BR"?f.parentNode.appendChild(document.createElement("br")):f.parentNode.parentNode.appendChild(document.createElement("br")):f.nodeType===Node.ELEMENT_NODE?f.appendChild(document.createElement("br")):t.appendChild(document.createElement("br")));const g=t.innerHTML;n!==t.innerHTML&&(t.innerHTML=n),D.push(an,cn,r,t.id,Le(n,g),i)}function fn(){Array.from(L.childNodes).forEach(e=>{if(e.nodeType===Node.TEXT_NODE&&e.textContent.trim()){const t=document.createElement("p");t.setAttribute("id",`text${$()}`),t.setAttribute("class",`text-block ${ve}`),t.textContent=e.textContent,L.replaceChild(t,e)}}),L.querySelectorAll("p p, h1 p, h2 p, h3 p, h4 p, h5 p, h6 p, p font, small p").forEach(e=>{const t=e.parentNode;if(!t.id&&e.childElementCount===1){t.insertBefore(e.firstChild,e),t.removeChild(e),t.id=e.id;return}for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)})}function xt(){if(L.firstChild&&L.firstChild.nodeName==="P")return;const e=L.innerHTML.trim();(e===""||e==="<br>"||e==="<br/>")&&(L.innerHTML=`<p class="text-block ${ve}" id="text${$()}"><br/></p>`)}function Ot(){(me.innerHTML==="<br>"||me.innerHTML==="<br/>")&&(me.innerHTML=""),document.title=me.innerHTML.trim()||"Memento Note"}function rt(e,t){let n=e?.startContainer;for(;n&&n!==L;){if(n.nodeType===Node.ELEMENT_NODE&&t(n)){const i=n.innerHTML,o=ne(n,e);let r=null;const l=e.startContainer,s=l.parentNode;if(l.nodeName==="BR"){const g=document.createElement("br");s.insertBefore(g,l.nextSibling),r=we(g)}else if(t(l)||l.nodeType===Node.ELEMENT_NODE){const g=document.createElement("br");l.childNodes.length>e.startOffset?l.insertBefore(g,l.childNodes[e.startOffset]):l.appendChild(g),r=we(g)}else if(l.nodeType===Node.TEXT_NODE){const g=l.textContent.substring(0,e.startOffset),E=l.textContent.substring(e.startOffset),c=E?.length?document.createTextNode(E):null,d=l.nextSibling,A=document.createElement("br");if(s.insertBefore(A,d),g?.length?l.textContent!==g&&(l.textContent=g):s.removeChild(l),c)s.insertBefore(c,d),r=oe(c,0);else if(g?.length)if(d)r=oe(s,Ne(d));else if(t(s)){const T=document.createElement("br");s.insertBefore(T,d),r=we(T)}else{let T=s;for(;T&&!T.nextSibling;)T=T.parentNode;T?.nextSibling&&(r=oe(T.nextSibling,0))}else{const T=document.createElement("br");s.insertBefore(T,d),r=we(T)}}!r&&window.getSelection().rangeCount&&(r=window.getSelection().getRangeAt(0));const a=n.innerHTML,f=r?ne(n,r):o;return i!==n.innerHTML&&(n.innerHTML=i),i!==a&&D.push(Ye,ze,n,Le(i,a),o,f),!0}n=n.parentNode}return!1}function mn(e,t,n){window.getSelection().removeAllRanges(),e.remove();const o=n?document.getElementById(n):null;if(o){let r=null;o.classList?.contains("code-block")?r=Be(o.querySelector("code")):r=Be(o),r&&oe(r,r.textContent?.length??0)}else L.focus()}function H(e){e.stopImmediatePropagation(),e.preventDefault()}function lt(e,t){let n=e.classList?.contains("code-block")&&e.firstChild.nodeName==="PRE"&&(!e.textContent?.length||e.textContent===`
`||e.innerText===`
`);if(n=n||e.classList?.contains("text-block")&&(!e.innerText?.length||e.innerText===`
`),n){H(t);let i=e.previousElementSibling;for(;i&&!i.classList?.contains("text-block")&&!i.classList?.contains("code-block");)i=i.previousElementSibling;return i&&D.push(mn,U,e,e.nextElementSibling?.id,i.id),!0}return!1}function gn(e){let t=e.lastChild;for(;t;){for(;t&&(t.nodeType!==Node.ELEMENT_NODE||!t.lastChild)&&!P(t).length;)t=t.previousSibling;if(t&&t.nodeName!=="BR"&&t.lastChild)t=t.lastChild;else break}t?.nodeName==="BR"&&t.remove()}function pn(e,t,n,i){const o=i?document.getElementById(i):null;if(!o)return;const r=e.innerHTML;gn(o);const l=e.firstChild;o.append(...e.childNodes),e.remove(),e.innerHTML=r,l&&oe(l,0)}function En(e,t,n,i){const o=i?document.getElementById(i):null;o&&(o.innerHTML=n,U(e,t))}function bn(e,t){if(t.startContainer===t.endContainer&&t.startOffset===t.endOffset){if(t.startOffset===0)return!0;if(t.startContainer===e){const n=[...e.childNodes];for(let i=0;i<t.startOffset&&i<n.length;i++)if(n[i].nodeType!==Node.TEXT_NODE||n[i].textContent.length>0)return!1;return!0}}return!1}function hn(e,t){if(t.startContainer===t.endContainer&&t.startOffset===t.endOffset)if(t.endContainer===e){const n=[...e.childNodes];if(n.length>0&&t.endOffset>-1){let i=0;for(let o=t.endOffset;o<n.length;o++){const r=n[o];if(r.nodeName==="BR"){if(++i,i>1)return!1}else if(P(r).length>0)return!1}}}else{if(t.endContainer.nodeType===Node.TEXT_NODE){const i=P(t.endContainer).length;if(i>0&&t.endOffset<i)return!1}let n=t.endContainer;for(;n!==e;){let i=n.nodeName==="BR"?1:0;for(;n.nextSibling;){if(n.nextSibling.nodeName==="BR"){if(++i,i>1)return!1}else if(P(n.nextSibling).length>0)return!1;n=n.nextSibling}n=n.parentNode}}else return!1;return!0}function he(e){return e&&(e.nodeName==="TH"||e.nodeName==="TD")}function J(e){return e&&(e.classList?.contains("text-block")||e.classList?.contains("code-block")||he(e))}function Fe(e){return e&&e.classList?.contains("embedded-table")}function Dt(e){for(;e;){if(he(e))return e;if(e.parentNode===L)return null;e=e.parentNode}return null}function An(e,t){const n=[];if(t)if(t.commonAncestorContainer.nodeType===Node.TEXT_NODE){const i=X(t.startContainer,e);if(i){const o=z(i),r=o.get(t.startContainer).start+t.startOffset,l=r+t.endOffset-t.startOffset;n.push({node:i,start:r,end:l,positions:o})}}else{let i=X(t.startContainer,e),o=X(t.endContainer,e);if(i&&o)if(i===o)if(J(i)){const r=z(i),l=r.get(t.startContainer).start+t.startOffset,s=r.get(t.endContainer).start+t.endOffset;n.push({node:i,start:l,end:s,positions:r})}else n.push({node:i});else{if(J(i)){const l=z(i),s=l.get(t.startContainer).start+t.startOffset,a=l.get(i).end;n.push({node:i,start:s,end:a,positions:l})}else n.push({node:i});let r=i.nextElementSibling;for(;r&&r!==o;){if(r.parentNode===e)if(J(r)){const l=z(r),s=l.get(r).start,a=l.get(r).end;n.push({node:r,start:s,end:a,positions:l})}else n.push({node:r});r=r.nextElementSibling}if(J(o)){const l=z(o),s=l.get(o).start,a=l.get(t.endContainer).start+t.endOffset;n.push({node:o,start:s,end:a,positions:l})}else n.push({node:o})}}return n}function st(e){if(he(e)){if(e.cellId)return e.cellId;let t=e,n=null;for(;t&&!Fe(t.parentNode);)t=t.parentNode,t.nodeName==="TR"&&(n=t);if(t?.parentNode){const o=t.parentNode.id,r=n?it(n)+1:null;if(r){const l=it(e)+1;return e.cellId=`#${o} tr:nth-of-type(${r}) ${e.nodeName.toLowerCase()}:nth-of-type(${l})`,e.cellId}}return null}return e?.id}function Rt(e){return e?e.includes(" ")?document.querySelector(e):document.getElementById(e):null}function Tn(e,t,n,i,o,r,l){for(let a of t)G(a);const s=Rt(e);if(s){const a=Ae(s.innerHTML,i);s.innerHTML!==a&&(s.innerHTML=a),re(s,l)}o&&(U(o,n),re(o,l))}function yn(e,t,n,i,o,r,l){o&&G(o);const s=Rt(e);if(s){const d=Ae(s.innerHTML,i,!0);s.innerHTML!==d&&(s.innerHTML=d)}let a=n;for(let d=t.length-1;d>-1;d--)U(t[d],a),a=t[d].id;let f=null,g=0,E=0;if(J(s)){f=s.classList?.contains("code-block")?s.querySelector("code"):s;const d=re(f,{start:r.start,end:t.length>0?r.start:r.end});d&&(f=d.startContainer,g=d.startOffset,E=d.endOffset)}else f=s.parentNode,g=Ne(s);let c=f;if(t.length>0){const d=t[t.length-1];if(d&&d!==s)if(J(d)){c=d.classList?.contains("code-block")?d.querySelector("code"):d;const A=re(c,{start:r.end,end:r.end});A&&(c=A.endContainer,E=A.endOffset)}else d&&(c=d.parentNode,E=Ne(d)+1)}if(f&&c){const d=document.createRange();d.setStart(f,g),d.setEnd(c,E),window.getSelection().removeAllRanges(),window.getSelection().addRange(d)}}function kt(e){const t=document.createElement("template");return t.innerHTML=e.trim(),[...t.content.childNodes].filter(n=>n.nodeName!=="META")}function Cn(e){const t=document.createElement("div");return t.innerHTML=e,P(t)}function xe(e){const t=new Set,n=e?.parentNode===L?e:X(e,L);let i=e;for(;n?.querySelectorAll('span[style~="color:" i] span[style~="color:" i]')?.forEach(o=>{o.style.color&&t.add(o)}),n?.querySelectorAll('span[style~="background-color:" i] span[style~="background-color:" i]')?.forEach(o=>{o.style.backgroundColor&&t.add(o)}),n?.querySelectorAll('span[style~="font-size:" i] span[style~="font-size:" i]')?.forEach(o=>{o.style.fontSize&&t.add(o)}),n?.querySelectorAll("strong strong, em em, u u, s s")?.forEach(o=>{t.add(o)}),t.size>0;){for(let o of t)if(o.childNodes?.length)o===i&&(i=o.childNodes[o.childNodes.length-1]),o.replaceWith(...o.childNodes);else{if(o===i&&(i=o.nextSibling,!i)){let r=o.parentNode;if(r&&r!==L)for(;r&&r.parentNode!==L&&!i;)i=r.nextSibling,r=r.parentNode;i||(i=n)}o.remove()}t.clear()}return i}function $e(e,t,n=!1){let i=null;if(n){let r=!1,l=t.startContainer;for(;l&&l!==L;){if(l.nodeName==="CODE"){r=!0;break}l=l.parentNode}r?(e=Cn(e),n=!1):(i=kt(e),e="")}function o(r){return r.nodeType===Node.TEXT_NODE?P(r).length:r.nodeType===Node.ELEMENT_NODE?r.nodeName==="BR"?1:r.childNodes.length:0}if(t.startContainer.nodeType===Node.TEXT_NODE){const r=i??Se(e,-1,-1,null);let l=t.startContainer.textContent;if(r.length===1){if(r[0].nodeType===Node.TEXT_NODE){e=P(r[0]);const s=t.startOffset+e.length;return l=l.substring(0,t.startOffset)+e+l.substring(t.startOffset),l!==t.startContainer.textContent&&(t.startContainer.textContent=l),{node:t.startContainer,offset:s}}else if(r[0].nodeType===Node.ELEMENT_NODE){const s=t.startContainer.parentNode,a=l.substring(0,t.startOffset),f=l.substring(t.startOffset),g=t.startContainer.nextSibling;return a!==t.startContainer.textContent&&(t.startContainer.textContent=a),s.insertBefore(r[0],g),f&&s.insertBefore(document.createTextNode(f),g),n&&(r[0]=xe(r[0])),{node:r[0],offset:o(r[0])}}}else if(r.length>1){const s=t.startContainer.parentNode,a=l.substring(0,t.startOffset),f=l.substring(t.startOffset),g=t.startContainer.nextSibling;l=a;let E=0;for(;E<r.length&&r[E].nodeType===Node.TEXT_NODE;)l+=P(r[E]),++E;for(let c=E;c<r.length;++c)s.insertBefore(r[c],g);if(E<r.length){l!==t.startContainer.textContent&&(t.startContainer.textContent=l);let c=r[r.length-1];if(c.nodeType===Node.TEXT_NODE){let d=P(c);const A=d.length;return d+=f,d!==c.textContent&&(c.textContent=d),n&&xe(s),{node:c,offset:A}}else f&&s.insertBefore(document.createTextNode(f),g);return n&&(c=xe(c)),{node:c,offset:o(c)}}else{const c=l.length;return l+=f,l!==t.startContainer.textContent&&(t.startContainer.textContent=l),{node:t.startContainer,offset:c}}}}else if(t.startContainer.nodeType===Node.ELEMENT_NODE){const r=i??Se(e,-1,-1,null);if(r.length>0){r.reverse(),r.forEach(s=>t.insertNode(s));let l=r[0];return n&&(l=xe(l)),{node:l,offset:o(l)}}}return null}function Ye(e,t,n,i){if(e){const o=Ae(e.innerHTML,t);e.innerHTML!==o&&(e.innerHTML=o),re(e,i)}}function ze(e,t,n,i){if(e){const o=Ae(e.innerHTML,t,!0);e.innerHTML!==o&&(e.innerHTML=o),re(e,n)}}function be(e){const t=e.classList?.contains("code-block")?e.querySelector("code"):e;if(P(t)){const n=[];let i=t.firstChild;for(;i;)P(i)||n.push(i),i=i.nextSibling;n.forEach(o=>o.remove())}else t.innerHTML="<br/>"}function Ke(e,t,n,i=!1){if(Fe(n)&&(n=Dt(t.startContainer),!n))return;const o=n.innerHTML,r=ne(n,t),l=$e(e,t,i);if(l)t.setStart(l.node,l.offset),t.setEnd(l.node,l.offset),window.getSelection().collapseToEnd();else return;be(n);const s=n.innerHTML,a=ne(n,t);o!==n.innerHTML&&(n.innerHTML=o),o!==s&&D.push(Ye,ze,n,Le(o,s),r,a)}function dt(e,t,n){if(Fe(t)&&(t=Dt(e.startContainer),!t))return;const i=t.innerHTML,o=ne(t,e),r={start:o.start+(n?-1:0),end:o.end+(n?0:1)},l=re(t,r);if(l){l.deleteContents(),window.getSelection().collapseToStart(),be(t);const s=t.innerHTML,a=ne(t,l);i!==t.innerHTML&&(t.innerHTML=i),i!==s&&D.push(Ye,ze,t,Le(i,s),o,a)}}function Me(e,t=!1){let n=null;const i=window.getSelection();if(i.rangeCount&&(n=i.getRangeAt(0)),n&&!i.isCollapsed){let o=n.commonAncestorContainer,r=L;for(;o&&o!==r;){if(he(o)){r=o.parentNode;break}o=o.parentNode}const l=An(r,n);if(l.length){let s=[],a=null,f=null,g=null,E=l[0].start;const c={start:l[0].start,end:l[l.length-1].end},d=l[0].node;if(l.length===1)if(J(d)){if(a=d.innerHTML,f=st(d),i.deleteFromDocument(),e){const v=$e(e,n,t);if(v)n.setStart(v.node,v.offset),n.setEnd(v.node,v.offset);else return!0}i.collapseToEnd(),be(d),E=ne(d,n).end}else L.firstChild!==d&&(s=[d]);else{s=l.map(v=>v.node);const b=l[l.length-1].node;if(J(b)){const v=n.cloneRange();if(v.setStart(n.endContainer,n.endOffset),v.setEndAfter(b.lastChild||b),g=v.cloneContents(),b.classList?.contains("code-block")){const m=g.querySelector("code").childNodes;m?.length?(g=document.createDocumentFragment(),m.forEach(p=>g.appendChild(p))):g=null}}if(J(d)){a=d.innerHTML,f=st(d);const v=d.classList?.contains("code-block")?d.querySelector("code"):d;if(n.setEndAfter(v.lastChild||v),n.deleteContents(),e){const p=$e(e,n,t);if(p)n.setStart(p.node,p.offset),n.setEnd(p.node,p.offset);else return!0}i.collapseToEnd(),be(d),E=ne(d,n).end,g&&(v.append(g),be(d)),s.shift()}else L.firstChild===d&&s.shift()}f||be(d);const A=f?d.innerHTML:null,T=f?null:document.createElement("p");T&&(T.setAttribute("id",`text${$()}`),T.setAttribute("class",`text-block ${ve}`),T.append(...t?kt(e):Se(e,-1,-1,null)),E=P(T).length,g&&T.append(g),P(T)||T.appendChild(document.createElement("br")));const M={start:E,end:E};(a!==A||T)&&(T||(d.innerHTML=a)),D.push(Tn,yn,f,s,l[l.length-1].node.nextElementSibling?.id,T?[]:Le(a,A),T,c,M)}return!0}return!1}function Sn(e){const t=e.key.toUpperCase();return t==="COPY"||t==="CUT"||t==="PASTE"||(t==="C"||t==="X"||t==="V")&&(e.ctrlKey||e.metaKey)}function Nn(e){const t=e.key.toUpperCase();return!!(t==="UNDO"||(e.ctrlKey||e.metaKey)&&!e.shiftKey&&t==="Z")}function Ln(e){const t=e.key.toUpperCase();return!!(t==="REDO"||e.ctrlKey&&t==="Y"||e.shiftKey&&e.metaKey&&t==="Z")}function vn(e){return e.key==="Delete"||e.key==="Del"||e.key.toUpperCase()==="D"&&e.ctrlKey}function In(e){return e.key==="Backspace"}const wn=["UNIDENTIFIED","ALT","ALTGRAPH","CAPSLOCK","CONTROL","FN","FNLOCK","HYPER","META","OS","NUMLOCK","SCROLLLOCK","SHIFT","SUPER","SYMBOL","SYMBOLLOCK","TAB","ARROWDOWN","ARROWLEFT","ARROWRIGHT","ARROWUP","DOWN","LEFT","RIGHT","UP","END","HOME","PAGEDOWN","PAGEUP","BACKSPACE","CLEAR","COPY","CRSEL","CUT","DEL","DELETE","ERASEEOF","EXSEL","INSERT","PASTE","REDO","UNDO","ACCEPT","AGAIN","ATTN","CANCEL","CONTEXTMENU","APPS","ESCAPE","ESC","EXECUTE","FIND","FINISH","HELP","PAUSE","PLAY","PROPS","SELECT","ZOOMIN","ZOOMOUT","BRIGHTNESSDOWN","BRIGHTNESSUP","EJECT","LOGOFF","POWER","POWEROFF","PRINTSCREEN","HIBERNATE","STANDBY","WAKEUP","ALLCANDIDATES","ALPHANUMERIC","CODEINPUT","COMPOSE","CONVERT","DEAD","FINALMODE","GROUPFIRST","GROUPLAST","GROUPNEXT","GROUPPREVIOUS","MODECHANGE","NEXTCANDIDATE","NONCONVERT","PREVIOUSCANDIDATE","PROCESS","SINGLECANDIDATE","HANGULMODE","HANJAMODE","JUNJAMODE","EISU","HANKAKU","HIRAGANA","HIRAGANAKATAKANA","KANAMODE","KANJIMODE","KATAKANA","ROMAJI","ZENKAKU","ZENKAKUHANKAKU","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","SOFT1","SOFT2","SOFT3","SOFT4","APPSWITCH","CALL","CAMERA","CAMERAFOCUS","ENDCALL","GOBACK","GOHOME","MOZHOMESCREEN","HEADSETHOOK","LASTNUMBERREDIAL","NOTIFICATION","MANNERMODE","VOICEDIAL","CHANNELDOWN","CHANNELUP","MEDIAFASTFORWARD","MEDIAPAUSE","MEDIAPLAY","MEDIAPLAYPAUSE","MEDIARECORD","MEDIAREWIND","MEDIASTOP","MEDIATRACKNEXT","MEDIATRACKPREVIOUS","AUDIOBALANCELEFT","AUDIOBALANCERIGHT","AUDIOBASSDOWN","AUDIOBASSBOOSTDOWN","AUDIOBASSBOOSTTOGGLE","AUDIOBASSBOOSTUP","AUDIOBASSUP","AUDIOFADERFRONT","AUDIOFADERREAR","AUDIOSURROUNDMODENEXT","AUDIOTREBLEDOWN","AUDIOTREBLEUP","AUDIOVOLUMEDOWN","AUDIOVOLUMEMUTE","AUDIOVOLUMEUP","MICROPHONETOGGLE","MICROPHONEVOLUMEDOWN","MICROPHONEVOLUMEMUTE","MICROPHONEVOLUMEUP","CLOSE","NEW","OPEN","PRINT","SAVE","SPELLCHECK","MAILFORWARD","MAILREPLY","MAILSEND","BROWSERBACK","BROWSERFAVORITES","BROWSERFORWARD","BROWSERHOME","BROWSERREFRESH","BROWSERSEARCH","BROWSERSTOP","KEY11","KEY12"];function xn(e){const t=e.key.toUpperCase();return wn.includes(t)?"":t==="ENTER"?`
`:t==="SPACEBAR"||t===" "?" ":e.ctrlKey||e.metaKey?"":e.key}function On(e,t,n,i,o){let r=null;const l=window.getSelection();if(l.rangeCount&&(r=l.getRangeAt(0)),!r){H(o);return}if(Me(e)){H(o);return}let s=r.startContainer;if(s){const g=["embedded-local-epub","embedded-local-pdf","embedded-local-image","embedded-local-audio","embedded-table","image-link","audio-link","video-link","pdf-link","audio-recording","recording-control-buttons-container"];if(s.parentNode&&[...s.parentNode.classList].some(E=>g.indexOf(E)>-1)){H(o);return}}else{H(o);return}if(e===`
`)if(i){if(rt(r,g=>g.classList?.contains("text-block"))){H(o);return}}else{if(rt(r,g=>["CODE","TD","TH"].includes(g.nodeName))){H(o);return}o.preventDefault(),un(r);return}let a=W(r);if(!a){H(o);return}let f=!1;if(t&&hn(a,r)){const g=a.nextElementSibling;if(g){const E=a.classList?.contains("text-block"),c=!E&&a.classList?.contains("code-block");if(E||c){const d=g.classList?.contains("text-block"),A=!d&&g.classList?.contains("code-block");if(d||A){if(f=E&&d,!f){const T=P(g);f=T===`
`||T.length===0}if(f)a=g,r=oe(A?g.querySelector("code"):g,0),s=r.startContainer;else{H(o);return}}else{H(o);return}}}}else f=n&&bn(a,r);if(f){if(a.classList?.contains("code-block")&&!s?.previousSibling){if(lt(a,o))return;H(o);return}if(a.classList?.contains("text-block")){if(lt(a,o))return;const g=a.previousElementSibling;if(a===s&&(!g||!g.classList?.contains("text-block"))){H(o);return}for(;s!==a;){for(;s.previousSibling;){if(s=s.previousSibling,s.nodeName==="BR")return;if(s.nodeType===Node.TEXT_NODE){if(P(s).length)return}else if(s.nodeType===Node.ELEMENT_NODE&&(P(s).length||s.querySelector("br")))return}s=s.parentNode}if(!g||!g.classList?.contains("text-block")){H(o);return}D.push(pn,En,a,a.nextElementSibling?.id,g.innerHTML,g.id),H(o);return}}if(t){dt(r,a,!1),H(o);return}else if(n){dt(r,a,!0),H(o);return}else if(e){Ke(e,r,a),H(o);return}}function Dn(e){if(Nn(e)){D.undo(),H(e);return}if(Ln(e)){D.redo(),H(e);return}if(Sn(e))return;const t=xn(e),n=vn(e),i=In(e);if(!t&&!n&&!i)return;const o=e.shiftKey;On(t,n,i,o,e)}function Rn(e){const t=document.createDocumentFragment(),n=[...e.childNodes];for(let i of n)if(i.nodeName==="BR")t.append(i);else if(i.nodeType===Node.TEXT_NODE)i.textContent&&(i.textContent===`
`?t.append(document.createElement("br")):t.append(i));else if(J(i)){const o=(i.classList?.contains("code-block")?i.querySelector("code"):i).childNodes;t.append(...o)}else return null;return t.querySelector(ut.join(", "))?t:null}function kn(e){let t=e.commonAncestorContainer,n=null,i=null;function o(r,l){const s=r.nodeType===Node.TEXT_NODE?document.createTextNode(r.textContent.substring(l.startOffset,l.endOffset)):document.createElement(r.nodeName.toLowerCase());if(r.nodeType===Node.ELEMENT_NODE){for(let a of r.attributes)s.setAttribute(a.name,a.value);r.style?.cssText&&(s.style.cssText=r.style.cssText),r.className&&(s.className=r.className)}return s}for(;t&&t!==L;){if(t.nodeName==="CODE")return null;if(J(t)){const r=document.createDocumentFragment();if(n=n||r,i=i||n,i.nodeType!==Node.TEXT_NODE){const s=e.cloneRange().cloneContents();i.append(...s.childNodes)}return n!==r&&r.append(n),r.querySelector(ut.join(", "))?r:null}else if(!t.id&&t.parentNode&&t.parentNode!==L&&t.parentNode.nodeName!=="CODE"){const r=o(t,e);n&&r.append(n),n=r,i=i||n}t=t.parentNode}return null}function Bn(e){if(!(e instanceof DocumentFragment))throw new TypeError("Expected a DocumentFragment.");const t=document.createElement("div");return t.appendChild(e),t.innerHTML}function Bt(e,t){let n=null;const i=window.getSelection();if(i.rangeCount&&(n=i.getRangeAt(0)),!n?.startContainer||!n.endContainer||n.startContainer===L||n.endContainer===L||i.isCollapsed){H(e);return}let o=kn(n);if(!o){const l=n.cloneRange().cloneContents();o=Rn(l)}if(o){const r=Bn(o);(e.clipboardData||window.clipboardData)?.setData("text/html",r)}else(e.clipboardData||window.clipboardData)?.setData("text/plain",i.toString());t&&Me(""),e.preventDefault()}function Mn(e){Bt(e,!0)}function _n(e){Bt(e,!1)}function Hn(e){let t=null;const n=window.getSelection();if(n.rangeCount&&(t=n.getRangeAt(0)),!t?.startContainer||!t.endContainer||t.startContainer===L||t.endContainer===L){H(e);return}const i=e.clipboardData||window.clipboardData;if(i){if(n.isCollapsed){const o=W(t);if(J(o)||Fe(o)){const r=i.getData("text")||i.getData("text/plain");if(r)Ke(r,t,o);else{const l=i.getData("html")||i.getData("text/html");l&&Ke(l,t,o,!0)}}}else{const o=i.getData("text")||i.getData("text/plain");if(o)Me(o);else{const r=i.getData("html")||i.getData("text/html");r&&Me(r,!0)}}H(e)}}function Fn(e){const t=e.target.closest("a");if(!t||!document.getElementById("editorContainer").contains(t))return;e.preventDefault(),confirm(`"${t.href}" open this url?`)&&window.open(t.href,"_blank")}function Un(e){L.contentEditable==="true"&&(e.preventDefault(),e.returnValue="")}function Mt(){document.querySelectorAll(".page-dropdown-content").forEach(e=>{e.style.maxHeight=null,e.classList?.remove("open")})}let Y=null;document.onselectionchange=()=>{const e=document.getSelection();if(e?.rangeCount){const t=e.getRangeAt(0);L.contains(t.commonAncestorContainer)&&(Y=t)}Y&&(Y.startContainer!==Y.endContainer||Y.startOffset!==Y.endOffset)&&L.contains(Y.commonAncestorContainer)?(document.getElementById("btnLinkText").removeAttribute("disabled"),document.getElementById("btnLinkText").setAttribute("title","Make text link"),document.getElementById("btnB").removeAttribute("disabled"),document.getElementById("btnB").setAttribute("title","Bold text"),document.getElementById("btnI").removeAttribute("disabled"),document.getElementById("btnI").setAttribute("title","Italic text"),document.getElementById("btnU").removeAttribute("disabled"),document.getElementById("btnU").setAttribute("title","Underline text"),document.getElementById("btnStrikethrough").removeAttribute("disabled"),document.getElementById("btnStrikethrough").setAttribute("title","Strikethrough text"),document.getElementById("btnTextColorMenu").removeAttribute("disabled"),document.getElementById("btnTextColorMenu").setAttribute("title","Colorize text"),document.getElementById("btnTextHighlightMenu").removeAttribute("disabled"),document.getElementById("btnTextHighlightMenu").setAttribute("title","Highlight text"),document.getElementById("btnFontScaleMenu").removeAttribute("disabled"),document.getElementById("btnFontScaleMenu").setAttribute("title","Change text scale"),document.getElementById("mbtnLinkText").removeAttribute("disabled"),document.getElementById("mbtnLinkText").setAttribute("title","Make text link"),document.getElementById("mbtnTextColorMenu").removeAttribute("disabled"),document.getElementById("mbtnTextColorMenu").setAttribute("title","Colorize text"),document.getElementById("mbtnTextHighlightMenu").removeAttribute("disabled"),document.getElementById("mbtnTextHighlightMenu").setAttribute("title","Highlight text"),document.getElementById("mbtnFontScaleMenu").removeAttribute("disabled"),document.getElementById("mbtnFontScaleMenu").setAttribute("title","Change text scale")):(document.getElementById("btnLinkText").setAttribute("disabled"," "),document.getElementById("btnLinkText").setAttribute("title","Select a text to make link"),document.getElementById("btnB").setAttribute("disabled"," "),document.getElementById("btnB").setAttribute("title","Select a text to make bold"),document.getElementById("btnI").setAttribute("disabled"," "),document.getElementById("btnI").setAttribute("title","Select a text to make italic"),document.getElementById("btnU").setAttribute("disabled"," "),document.getElementById("btnU").setAttribute("title","Select a text to underline"),document.getElementById("btnStrikethrough").setAttribute("disabled"," "),document.getElementById("btnStrikethrough").setAttribute("title","Select a text to strikethrough"),document.getElementById("btnTextColorMenu").setAttribute("disabled"," "),document.getElementById("btnTextColorMenu").setAttribute("title","Select a text to colorize"),document.getElementById("btnTextHighlightMenu").setAttribute("disabled"," "),document.getElementById("btnTextHighlightMenu").setAttribute("title","Select a text to highlight"),document.getElementById("btnFontScaleMenu").setAttribute("disabled"," "),document.getElementById("btnFontScaleMenu").setAttribute("title","Select a text to change scale"),document.getElementById("mbtnLinkText").setAttribute("disabled"," "),document.getElementById("mbtnLinkText").setAttribute("title","Select a text to make link"),document.getElementById("mbtnTextColorMenu").setAttribute("disabled"," "),document.getElementById("mbtnTextColorMenu").setAttribute("title","Select a text to colorize"),document.getElementById("mbtnTextHighlightMenu").setAttribute("disabled"," "),document.getElementById("mbtnTextHighlightMenu").setAttribute("title","Select a text to highlight"),document.getElementById("mbtnFontScaleMenu").setAttribute("disabled"," "),document.getElementById("mbtnFontScaleMenu").setAttribute("title","Select a text to change scale"))};L.addEventListener("keydown",Dn);L.addEventListener("click",Fn);L.addEventListener("blur",fn);L.addEventListener("input",xt);L.addEventListener("focus",xt);L.addEventListener("cut",Mn);L.addEventListener("copy",_n);L.addEventListener("paste",Hn);me.addEventListener("input",Ot);window.addEventListener("beforeunload",Un);document.querySelectorAll(".text-block").forEach(e=>{e.getAttribute("id")||e.setAttribute("id",`text${$()}`)});Ot();document.querySelectorAll(".embedded-math math").forEach(e=>e.addEventListener("click",Ct));document.getElementById("btnH1").addEventListener("click",e=>de("xlarge-text"));document.getElementById("btnH2").addEventListener("click",e=>de("large-text"));document.getElementById("btnM").addEventListener("click",e=>de("medium-text"));document.getElementById("btnS").addEventListener("click",e=>de("small-text"));document.getElementById("mbtnH1").addEventListener("click",e=>{S("styleDropdown"),de("xlarge-text")});document.getElementById("mbtnH2").addEventListener("click",e=>{S("styleDropdown"),de("large-text")});document.getElementById("mbtnM").addEventListener("click",e=>{S("styleDropdown"),de("medium-text")});document.getElementById("mbtnS").addEventListener("click",e=>{S("styleDropdown"),de("small-text")});document.getElementById("btnB").addEventListener("click",e=>He(ft));document.getElementById("btnI").addEventListener("click",e=>He(mt));document.getElementById("btnU").addEventListener("click",e=>He(gt));document.getElementById("btnStrikethrough").addEventListener("click",e=>He(pt));document.getElementById("btnTextColorMenu").addEventListener("click",e=>S("textColorDropdown"));for(let e=1;e<je+1;++e)document.getElementById(`btnTextColor${e}`).addEventListener("click",t=>{tt(e),S("textColorDropdown")}),document.getElementById(`mbtnTextColor${e}`).addEventListener("click",t=>{tt(e),S("styleDropdown")});document.getElementById("btnTextHighlightMenu").addEventListener("click",e=>S("highlightDropdown"));for(let e=1;e<Ge+1;++e)document.getElementById(`btnTextHighlight${e}`).addEventListener("click",t=>{nt(e),S("highlightDropdown")}),document.getElementById(`mbtnTextHighlight${e}`).addEventListener("click",t=>{nt(e),S("styleDropdown")});document.getElementById("btnFontScaleMenu").addEventListener("click",e=>S("fontScaleDropdown"));for(let e=1;e<qe+1;++e)document.getElementById(`btnFontScale${e}`).addEventListener("click",t=>{et(e),S("fontScaleDropdown")}),document.getElementById(`mbtnFontScale${e}`).addEventListener("click",t=>{et(e),S("styleDropdown")});document.getElementById("btnAlign").addEventListener("click",e=>S("alignDropdown"));document.getElementById("btnLeftTextAlign").addEventListener("click",e=>{S("alignDropdown"),se(le.LEFT)});document.getElementById("btnCenterTextAlign").addEventListener("click",e=>{S("alignDropdown"),se(le.CENTER)});document.getElementById("btnRightTextAlign").addEventListener("click",e=>{S("alignDropdown"),se(le.RIGHT)});document.getElementById("btnJustifyTextAlign").addEventListener("click",e=>{S("alignDropdown"),se(le.JUSTIFY)});document.getElementById("mbtnLeftTextAlign").addEventListener("click",e=>{S("styleDropdown"),se(le.LEFT)});document.getElementById("mbtnCenterTextAlign").addEventListener("click",e=>{S("styleDropdown"),se(le.CENTER)});document.getElementById("mbtnRightTextAlign").addEventListener("click",e=>{S("styleDropdown"),se(le.RIGHT)});document.getElementById("mbtnJustifyTextAlign").addEventListener("click",e=>{S("styleDropdown"),se(le.JUSTIFY)});document.getElementById("btnText").addEventListener("click",e=>on());document.getElementById("btnCode").addEventListener("click",e=>rn());document.getElementById("btnLinks").addEventListener("click",e=>S("linksDropdown"));document.getElementById("btnLinkText").addEventListener("click",e=>{S("linksDropdown"),wt()});document.getElementById("btnLinkImage").addEventListener("click",e=>{S("linksDropdown"),bt()});document.getElementById("btnLinkAudio").addEventListener("click",e=>{S("linksDropdown"),At()});document.getElementById("btnLinkVideo").addEventListener("click",e=>{S("linksDropdown"),Tt()});document.getElementById("btnLinkPdf").addEventListener("click",e=>{S("linksDropdown"),vt()});document.getElementById("mbtnLinkText").addEventListener("click",e=>{S("insertDropdown"),wt()});document.getElementById("mbtnLinkImage").addEventListener("click",e=>{S("insertDropdown"),bt()});document.getElementById("mbtnLinkAudio").addEventListener("click",e=>{S("insertDropdown"),At()});document.getElementById("mbtnLinkVideo").addEventListener("click",e=>{S("insertDropdown"),Tt()});document.getElementById("mbtnLinkPdf").addEventListener("click",e=>{S("insertDropdown"),vt()});document.getElementById("btnEmbed").addEventListener("click",e=>S("embedDropdown"));document.getElementById("btnEmbedWeb").addEventListener("click",e=>{S("embedDropdown"),It()});document.getElementById("imageUpload").addEventListener("change",e=>{S("embedDropdown"),Et(e)});document.getElementById("audioUpload").addEventListener("change",e=>{S("embedDropdown"),ht(event)});document.getElementById("pdfUpload").addEventListener("change",e=>{S("embedDropdown"),Lt(e)});document.getElementById("epubUpload").addEventListener("change",e=>{S("embedDropdown"),Nt(e)});document.getElementById("mbtnEmbedWeb").addEventListener("click",e=>{S("insertDropdown"),It()});document.getElementById("mimageUpload").addEventListener("change",e=>{S("insertDropdown"),Et(e)});document.getElementById("maudioUpload").addEventListener("change",e=>{S("insertDropdown"),ht(event)});document.getElementById("mpdfUpload").addEventListener("change",e=>{S("insertDropdown"),Lt(e)});document.getElementById("mepubUpload").addEventListener("change",e=>{S("insertDropdown"),Nt(e)});document.getElementById("btnRecordAudio").addEventListener("click",e=>Qt());document.getElementById("btnEmbedMath").addEventListener("click",e=>St());document.getElementById("mbtnEmbedMath").addEventListener("click",e=>{S("insertDropdown"),St()});document.getElementById("btnTable").addEventListener("click",e=>S("tableDropdown"));document.getElementById("btnSimpleTable").addEventListener("click",e=>{S("tableDropdown"),_e(!1)});document.getElementById("btnHeadlessTable").addEventListener("click",e=>{S("tableDropdown"),_e(!0)});document.getElementById("mbtnSimpleTable").addEventListener("click",e=>{S("insertDropdown"),_e(!1)});document.getElementById("mbtnHeadlessTable").addEventListener("click",e=>{S("insertDropdown"),_e(!0)});document.getElementById("btnUndo").addEventListener("click",e=>D.undo());document.getElementById("btnRedo").addEventListener("click",e=>D.redo());document.getElementById("btnSaveMenu").addEventListener("click",e=>S("saveDropdown"));document.getElementById("mbtnSaveMenu").addEventListener("click",e=>S("msaveDropdown"));document.getElementById("btnSave").addEventListener("click",e=>{S("saveDropdown"),Q(q.DOWNLOAD,!0)});document.getElementById("btnSaveTo").addEventListener("click",async e=>{S("saveDropdown"),Q(q.FILE,!0)});document.getElementById("btnShare").addEventListener("click",e=>{S("saveDropdown"),Q(q.SHARE,!0)});document.getElementById("btnSaveReadOnly").addEventListener("click",e=>{S("saveDropdown"),Q(q.DOWNLOAD,!1)});document.getElementById("btnSaveToReadOnly").addEventListener("click",async e=>{S("saveDropdown"),Q(q.FILE,!1)});document.getElementById("btnShareReadOnly").addEventListener("click",e=>{S("saveDropdown"),Q(q.SHARE,!1)});document.getElementById("mbtnSave").addEventListener("click",e=>{S("msaveDropdown"),Q(q.DOWNLOAD,!0)});document.getElementById("mbtnSaveTo").addEventListener("click",async e=>{S("msaveDropdown"),Q(q.FILE,!0)});document.getElementById("mbtnShare").addEventListener("click",e=>{S("msaveDropdown"),Q(q.SHARE,!0)});document.getElementById("mbtnSaveReadOnly").addEventListener("click",e=>{S("msaveDropdown"),Q(q.DOWNLOAD,!1)});document.getElementById("mbtnSaveToReadOnly").addEventListener("click",async e=>{S("msaveDropdown"),Q(q.FILE,!1)});document.getElementById("mbtnShareReadOnly").addEventListener("click",e=>{S("msaveDropdown"),Q(q.SHARE,!1)});document.getElementById("mbtnStyle").addEventListener("click",e=>{Mt(),S("styleDropdown")});document.getElementById("mbtnInsert").addEventListener("click",e=>{Mt(),S("insertDropdown")});document.getElementById("mbtnCancelStyle").addEventListener("click",e=>S("styleDropdown"));document.getElementById("mbtnCancelInsert").addEventListener("click",e=>S("insertDropdown"));document.getElementById("mbtnCancelSave").addEventListener("click",e=>S("msaveDropdown"));document.querySelectorAll(".page-dropdown-header").forEach(e=>{e.addEventListener("click",()=>{const t=e.nextElementSibling;document.querySelectorAll(".page-dropdown-content").forEach(n=>{n!==t&&(n.style.maxHeight=null,n.classList?.remove("open"))}),t.style.maxHeight?(t.style.maxHeight=null,t.classList?.remove("open")):(t.style.maxHeight=t.scrollHeight+"px",t.classList?.add("open"))})});L.focus();function Pn(){document.querySelectorAll(".embedded-local-epub").forEach(async e=>{const t=e.getAttribute("data-epub");await window.editor_imodule_obj.loadEpub(t,null,e)})}Pn()});export default $n();
